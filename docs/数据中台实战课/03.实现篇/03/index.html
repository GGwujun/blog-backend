<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1, maximum-scale=1, minimum-scale=1, user-scalable=no"
    />
    <link rel="shortcut icon" type="image/x-icon" href="/logo.png" />
    <link rel="stylesheet" href="/blog-backend/umi.3ec1f225.css" />
    <script>
      window.routerBase = "/blog-backend";
    </script>
    <script>
      //! umi version: 3.5.41
    </script>
    <script>
      !(function () {
        var e =
            navigator.cookieEnabled && void 0 !== window.localStorage
              ? localStorage.getItem("dumi:prefers-color")
              : "auto",
          o = window.matchMedia("(prefers-color-scheme: dark)").matches,
          t = ["light", "dark", "auto"];
        document.documentElement.setAttribute(
          "data-prefers-color",
          e === t[2] ? (o ? t[1] : t[0]) : t.indexOf(e) > -1 ? e : t[0]
        );
      })();
    </script>
    <title>06 | 数据模型无法复用，归根结底还是设计问题 - 大师兄</title>
  </head>
  <body>
    <div id="root"><div class="__dumi-default-layout" data-route="/数据中台实战课/03.实现篇/03" data-show-sidemenu="true" data-show-slugs="true" data-site-mode="true" data-gapless="false"><div class="__dumi-default-navbar" data-mode="site"><button class="__dumi-default-navbar-toggle"></button><a class="__dumi-default-navbar-logo" style="background-image:url(&#x27;/logo.png&#x27;)" href="/blog-backend/">大师兄</a><nav><div class="__dumi-default-search"><input type="search" class="__dumi-default-search-input" value=""/><ul></ul></div><span>后端开发<ul><li><a href="/blog-backend/go语言核心36讲">go语言核心36讲</a></li><li><a href="/blog-backend/go并发编程实战">go并发编程实战</a></li><li><a href="/blog-backend/go语言项目开发实战">go语言项目开发实战</a></li><li><a href="/blog-backend/kafka核心技术与实战">kafka核心技术与实战</a></li><li><a href="/blog-backend/kafka核心源码解读">kafka核心源码解读</a></li><li><a href="/blog-backend/零基础学python">零基础学python</a></li><li><a href="/blog-backend/python核心技术与实战">python核心技术与实战</a></li><li><a href="/blog-backend/redis核心技术与实战">redis核心技术与实战</a></li><li><a href="/blog-backend/redis源码剖析与实战">redis源码剖析与实战</a></li><li><a href="/blog-backend/陈天rust编程第一课">陈天rust编程第一课</a></li><li><a href="/blog-backend/tonybaigo语言第一课">tonybaigo语言第一课</a></li><li><a href="/blog-backend/后端存储实战课">后端存储实战课</a></li><li><a href="/blog-backend/后端技术面试38讲">后端技术面试38讲</a></li><li><a href="/blog-backend/深入c语言和程序运行原理">深入c语言和程序运行原理</a></li><li><a href="/blog-backend/现代c编程实战">现代c编程实战</a></li><li><a href="/blog-backend/罗剑锋的c实战笔记">罗剑锋的c实战笔记</a></li><li><a href="/blog-backend/零基础入门spark">零基础入门spark</a></li></ul></span><span>架构师<ul><li><a href="/blog-backend/mysql实战45讲">mysql实战45讲</a></li><li><a aria-current="page" class="active" href="/blog-backend/数据中台实战课">数据中台实战课</a></li></ul></span><div class="__dumi-default-navbar-tool"><div class="__dumi-default-dark"><div class="__dumi-default-dark-switch "></div></div></div></nav></div><div class="__dumi-default-menu" data-mode="site"><div class="__dumi-default-menu-inner"><div class="__dumi-default-menu-header"><a class="__dumi-default-menu-logo" style="background-image:url(&#x27;/logo.png&#x27;)" href="/blog-backend/"></a><h1>大师兄</h1><p></p></div><div class="__dumi-default-menu-mobile-area"><ul class="__dumi-default-menu-nav-list"><li>后端开发<ul><li><a href="/blog-backend/go语言核心36讲">go语言核心36讲</a></li><li><a href="/blog-backend/go并发编程实战">go并发编程实战</a></li><li><a href="/blog-backend/go语言项目开发实战">go语言项目开发实战</a></li><li><a href="/blog-backend/kafka核心技术与实战">kafka核心技术与实战</a></li><li><a href="/blog-backend/kafka核心源码解读">kafka核心源码解读</a></li><li><a href="/blog-backend/零基础学python">零基础学python</a></li><li><a href="/blog-backend/python核心技术与实战">python核心技术与实战</a></li><li><a href="/blog-backend/redis核心技术与实战">redis核心技术与实战</a></li><li><a href="/blog-backend/redis源码剖析与实战">redis源码剖析与实战</a></li><li><a href="/blog-backend/陈天rust编程第一课">陈天rust编程第一课</a></li><li><a href="/blog-backend/tonybaigo语言第一课">tonybaigo语言第一课</a></li><li><a href="/blog-backend/后端存储实战课">后端存储实战课</a></li><li><a href="/blog-backend/后端技术面试38讲">后端技术面试38讲</a></li><li><a href="/blog-backend/深入c语言和程序运行原理">深入c语言和程序运行原理</a></li><li><a href="/blog-backend/现代c编程实战">现代c编程实战</a></li><li><a href="/blog-backend/罗剑锋的c实战笔记">罗剑锋的c实战笔记</a></li><li><a href="/blog-backend/零基础入门spark">零基础入门spark</a></li></ul></li><li>架构师<ul><li><a href="/blog-backend/mysql实战45讲">mysql实战45讲</a></li><li><a aria-current="page" class="active" href="/blog-backend/数据中台实战课">数据中台实战课</a></li></ul></li></ul><div class="__dumi-default-dark"><div class="__dumi-default-dark-switch "><button title="Dark theme" class="__dumi-default-dark-moon "><svg viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="3854" width="22" height="22"><path d="M991.816611 674.909091a69.166545 69.166545 0 0 0-51.665455-23.272727 70.795636 70.795636 0 0 0-27.438545 5.585454A415.674182 415.674182 0 0 1 754.993338 698.181818c-209.594182 0-393.472-184.785455-393.472-395.636363 0-52.363636 38.539636-119.621818 69.515637-173.614546 4.887273-8.610909 9.634909-16.756364 14.103272-24.901818A69.818182 69.818182 0 0 0 384.631156 0a70.842182 70.842182 0 0 0-27.438545 5.585455C161.678429 90.298182 14.362065 307.898182 14.362065 512c0 282.298182 238.824727 512 532.38691 512a522.286545 522.286545 0 0 0 453.957818-268.334545A69.818182 69.818182 0 0 0 991.816611 674.909091zM546.679156 954.181818c-248.785455 0-462.941091-192-462.941091-442.181818 0-186.647273 140.637091-372.829091 300.939637-442.181818-36.817455 65.629091-92.578909 151.970909-92.578909 232.727273 0 250.181818 214.109091 465.454545 462.917818 465.454545a488.331636 488.331636 0 0 0 185.181091-46.545455 453.003636 453.003636 0 0 1-393.565091 232.727273z m103.656728-669.323636l-14.266182 83.781818a34.909091 34.909091 0 0 0 50.362182 36.770909l74.775272-39.563636 74.752 39.563636a36.142545 36.142545 0 0 0 16.174546 3.956364 34.909091 34.909091 0 0 0 34.210909-40.727273l-14.289455-83.781818 60.509091-59.345455a35.025455 35.025455 0 0 0-19.223272-59.578182l-83.61891-12.101818-37.376-76.101818a34.56 34.56 0 0 0-62.254545 0l-37.376 76.101818-83.618909 12.101818a34.909091 34.909091 0 0 0-19.246546 59.578182z m70.423272-64.698182a34.280727 34.280727 0 0 0 26.135273-19.083636l14.312727-29.090909 14.336 29.090909a34.257455 34.257455 0 0 0 26.135273 19.083636l32.046546 4.887273-23.272728 22.574545a35.234909 35.234909 0 0 0-10.007272 30.952727l5.46909 32.116364-28.625454-15.127273a34.490182 34.490182 0 0 0-32.302546 0l-28.695272 15.127273 5.469091-32.116364a35.141818 35.141818 0 0 0-9.984-30.952727l-23.272728-22.574545z" p-id="3855"></path></svg></button><button title="Light theme" class="__dumi-default-dark-sun "><svg viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="4026" width="22" height="22"><path d="M915.2 476.16h-43.968c-24.704 0-44.736 16-44.736 35.84s20.032 35.904 44.736 35.904H915.2c24.768 0 44.8-16.064 44.8-35.904s-20.032-35.84-44.8-35.84zM512 265.6c-136.704 0-246.464 109.824-246.464 246.4 0 136.704 109.76 246.464 246.464 246.464S758.4 648.704 758.4 512c0-136.576-109.696-246.4-246.4-246.4z m0 425.6c-99.008 0-179.2-80.128-179.2-179.2 0-98.944 80.192-179.2 179.2-179.2S691.2 413.056 691.2 512c0 99.072-80.192 179.2-179.2 179.2zM197.44 512c0-19.84-19.136-35.84-43.904-35.84H108.8c-24.768 0-44.8 16-44.8 35.84s20.032 35.904 44.8 35.904h44.736c24.768 0 43.904-16.064 43.904-35.904zM512 198.464c19.776 0 35.84-20.032 35.84-44.8v-44.8C547.84 84.032 531.84 64 512 64s-35.904 20.032-35.904 44.8v44.8c0 24.768 16.128 44.864 35.904 44.864z m0 627.136c-19.776 0-35.904 20.032-35.904 44.8v44.736C476.096 940.032 492.16 960 512 960s35.84-20.032 35.84-44.8v-44.736c0-24.768-16.064-44.864-35.84-44.864z m329.92-592.832c17.472-17.536 20.288-43.072 6.4-57.024-14.016-14.016-39.488-11.2-57.024 6.336-4.736 4.864-26.496 26.496-31.36 31.36-17.472 17.472-20.288 43.008-6.336 57.024 13.952 14.016 39.488 11.2 57.024-6.336 4.8-4.864 26.496-26.56 31.296-31.36zM213.376 759.936c-4.864 4.8-26.56 26.624-31.36 31.36-17.472 17.472-20.288 42.944-6.4 56.96 14.016 13.952 39.552 11.2 57.024-6.336 4.8-4.736 26.56-26.496 31.36-31.36 17.472-17.472 20.288-43.008 6.336-56.96-14.016-13.952-39.552-11.072-56.96 6.336z m19.328-577.92c-17.536-17.536-43.008-20.352-57.024-6.336-14.08 14.016-11.136 39.488 6.336 57.024 4.864 4.864 26.496 26.56 31.36 31.424 17.536 17.408 43.008 20.288 56.96 6.336 14.016-14.016 11.264-39.488-6.336-57.024-4.736-4.864-26.496-26.56-31.296-31.424z m527.168 628.608c4.864 4.864 26.624 26.624 31.36 31.424 17.536 17.408 43.072 20.224 57.088 6.336 13.952-14.016 11.072-39.552-6.4-57.024-4.864-4.8-26.56-26.496-31.36-31.36-17.472-17.408-43.072-20.288-57.024-6.336-13.952 14.016-11.008 39.488 6.336 56.96z" p-id="4027"></path></svg></button><button title="Default to system" class="__dumi-default-dark-auto "><svg viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="11002" width="22" height="22"><path d="M127.658667 492.885333c0-51.882667 10.24-101.717333 30.378666-149.162666s47.786667-88.064 81.92-122.538667 75.093333-61.781333 122.538667-81.92 96.938667-30.378667 149.162667-30.378667 101.717333 10.24 149.162666 30.378667 88.405333 47.786667 122.88 81.92 61.781333 75.093333 81.92 122.538667 30.378667 96.938667 30.378667 149.162666-10.24 101.717333-30.378667 149.162667-47.786667 88.405333-81.92 122.88-75.093333 61.781333-122.88 81.92-97.28 30.378667-149.162666 30.378667-101.717333-10.24-149.162667-30.378667-88.064-47.786667-122.538667-81.92-61.781333-75.093333-81.92-122.88-30.378667-96.938667-30.378666-149.162667z m329.045333 0c0 130.048 13.994667 244.394667 41.984 343.381334h12.970667c46.762667 0 91.136-9.216 133.461333-27.306667s78.848-42.666667 109.568-73.386667 54.954667-67.242667 73.386667-109.568 27.306667-86.698667 27.306666-133.461333c0-46.421333-9.216-90.794667-27.306666-133.12s-42.666667-78.848-73.386667-109.568-67.242667-54.954667-109.568-73.386667-86.698667-27.306667-133.461333-27.306666h-11.605334c-28.672 123.562667-43.349333 237.909333-43.349333 343.722666z" p-id="11003"></path></svg></button></div></div></div><ul class="__dumi-default-menu-list"><li><a href="/blog-backend/数据中台实战课">数据中台实战课</a></li><li><a href="/blog-backend/数据中台实战课/01.开篇词">01.开篇词</a><ul><li><a href="/blog-backend/数据中台实战课/01.开篇词/01"><span>开篇词  | 数据中台，是陷阱？还是金钥匙？</span></a></li></ul></li><li><a href="/blog-backend/数据中台实战课/02.原理篇">02.原理篇</a><ul><li><a href="/blog-backend/数据中台实战课/02.原理篇/01"><span>01 | 前因后果：为什么说数据中台是大数据的下一站？</span></a></li><li><a href="/blog-backend/数据中台实战课/02.原理篇/02"><span>02 | 关键抉择： 到底什么样的企业应该建数据中台？</span></a></li><li><a href="/blog-backend/数据中台实战课/02.原理篇/03"><span>03 | 数据中台建设三板斧：方法论、组织和技术</span></a></li><li><a href="/blog-backend/数据中台实战课/02.原理篇/04"><span>特别放送｜史凯：建设数据中台到底有什么用？</span></a></li></ul></li><li><a aria-current="page" class="active" href="/blog-backend/数据中台实战课/03.实现篇">03.实现篇</a><ul><li><a href="/blog-backend/数据中台实战课/03.实现篇/01"><span>04 | 元数据中心的关键目标和技术实现方案</span></a></li><li><a href="/blog-backend/数据中台实战课/03.实现篇/02"><span>05 | 如何统一管理纷繁杂乱的数据指标？</span></a></li><li><a aria-current="page" class="active" href="/blog-backend/数据中台实战课/03.实现篇/03"><span>06 |  数据模型无法复用，归根结底还是设计问题</span></a></li><li><a href="/blog-backend/数据中台实战课/03.实现篇/04"><span>07 | 同事老打脸说数据有问题，该怎么彻底解决？</span></a></li><li><a href="/blog-backend/数据中台实战课/03.实现篇/05"><span>08 | 交付速度和质量问题解决了，老板说还得“省”</span></a></li><li><a href="/blog-backend/数据中台实战课/03.实现篇/06"><span>09 | 数据服务到底解决了什么问题？</span></a></li><li><a href="/blog-backend/数据中台实战课/03.实现篇/07"><span>10 | 数据服务难道就是对外提供个API吗？</span></a></li><li><a href="/blog-backend/数据中台实战课/03.实现篇/08"><span>11 | 怎么一劳永逸地解决数据安全问题？</span></a></li><li><a href="/blog-backend/数据中台实战课/03.实现篇/09"><span>12 | 数据的台子搭完了，但你还得想好戏该怎么唱</span></a></li><li><a href="/blog-backend/数据中台实战课/03.实现篇/10"><span>13 | 数据研发就只是写代码吗？</span></a></li><li><a href="/blog-backend/数据中台实战课/03.实现篇/11"><span>14 | 数据被加工后，你还要学会使用和管理数据</span></a></li><li><a href="/blog-backend/数据中台实战课/03.实现篇/12"><span>15 | 数据中台在网易电商业务的最佳实践</span></a></li></ul></li><li><a href="/blog-backend/数据中台实战课/04.结束语">04.结束语</a><ul><li><a href="/blog-backend/数据中台实战课/04.结束语/01"><span>结课测试 | 建设数据中台的这些知识，你都掌握了吗？</span></a></li><li><a href="/blog-backend/数据中台实战课/04.结束语/02"><span>结束语 | 数据中台从哪里来，要到哪里去？</span></a></li></ul></li><li><a href="/blog-backend/数据中台实战课/summary">数据中台实战课</a></li></ul></div></div><ul role="slug-list" class="__dumi-default-layout-toc"><li title="什么才是一个好的数据模型设计？" data-depth="2"><a href="/blog-backend/数据中台实战课/03.实现篇/03#什么才是一个好的数据模型设计"><span>什么才是一个好的数据模型设计？</span></a></li><li title="如何衡量完善度" data-depth="3"><a href="/blog-backend/数据中台实战课/03.实现篇/03#如何衡量完善度"><span>如何衡量完善度</span></a></li><li title="如何衡量复用度" data-depth="3"><a href="/blog-backend/数据中台实战课/03.实现篇/03#如何衡量复用度"><span>如何衡量复用度</span></a></li><li title="如何衡量规范度" data-depth="3"><a href="/blog-backend/数据中台实战课/03.实现篇/03#如何衡量规范度"><span>如何衡量规范度</span></a></li><li title="如何从烟囱式的小数仓到共享的数据中台" data-depth="2"><a href="/blog-backend/数据中台实战课/03.实现篇/03#如何从烟囱式的小数仓到共享的数据中台"><span>如何从烟囱式的小数仓到共享的数据中台</span></a></li><li title="数仓建模工具EasyDesign" data-depth="2"><a href="/blog-backend/数据中台实战课/03.实现篇/03#数仓建模工具easydesign"><span>数仓建模工具EasyDesign</span></a></li><li title="课堂总结" data-depth="2"><a href="/blog-backend/数据中台实战课/03.实现篇/03#课堂总结"><span>课堂总结</span></a></li><li title="思考时间" data-depth="2"><a href="/blog-backend/数据中台实战课/03.实现篇/03#思考时间"><span>思考时间</span></a></li></ul><div class="__dumi-default-layout-content"><div class="markdown"><h1 id="06---数据模型无法复用归根结底还是设计问题"><a aria-hidden="true" tabindex="-1" href="/blog-backend/数据中台实战课/03.实现篇/03#06---数据模型无法复用归根结底还是设计问题"><span class="icon icon-link"></span></a>06 |  数据模型无法复用，归根结底还是设计问题</h1><p>你好，我是郭忆。</p><p>上一节课，我带你了解了数据中台如何管理指标，如果我们把指标比喻成一棵树上的果实，那模型就是这棵大树的躯干，想让果实结得好，必须让树干变得粗壮。</p><p>先来看一幕真实的场景。</p><p>大多数公司的分析师会结合业务做一些数据分析（需要用到大量的数据），通过报表的方式服务于业务部门的运营。但是在数据中台构建之前，分析师经常发现自己没有可以复用的数据，不得不使用原始数据进行清洗、加工、计算指标。</p><p>由于他们大多是非技术专业出身，写的SQL 质量比较差，我甚至见过5层以上的嵌套。这种SQL 对资源消耗非常大，会造成队列阻塞，影响其他数仓任务，会引起数据开发的不满。数据开发会要求收回分析师的原始数据读取权限，分析师又会抱怨数仓数据不完善，要啥没啥，一个需求经常要等一周甚至半个月。分析师与数据开发的矛盾从此开始。</p><p>这个矛盾的根源在于数据模型无法复用，数据开发是烟囱式的，每次遇到新的需求，都从原始数据重新计算，自然耗时。而要解决这个矛盾，就要搞清楚我们的数据模型应该设计成什么样子。</p><h2 id="什么才是一个好的数据模型设计"><a aria-hidden="true" tabindex="-1" href="/blog-backend/数据中台实战课/03.实现篇/03#什么才是一个好的数据模型设计"><span class="icon icon-link"></span></a>什么才是一个好的数据模型设计？</h2><p>来看一组数据，这两个表格是基于元数据中心提供的血缘信息，分别对大数据平台上运行的任务和分析查询（Ad-hoc）进行的统计。</p><p><img src="/blog-backend/static/httpsstatic001geekbangorgresourceimage192b19c8925b0107dc7ad298d9bb62971d2b.aa4b9082.jpg" alt="" title="表1 离线调度任务/表统计"/></p><p><img src="/blog-backend/static/httpsstatic001geekbangorgresourceimage37d3371cfb2754297d211d9cd5b2af48fdd3.32d79aca.jpg" alt="" title="表2 一周内Ad-hoc 查询统计"/></p><p>下图是数仓分层架构图，方便你回忆数据模型分层的设计架构：</p><p><img src="/blog-backend/static/httpsstatic001geekbangorgresourceimage91d59199d1545ecf90454882f01868f68ed5.9e62f790.jpg" alt=""/></p><p>我们首先来看表1。表1中有2547张未识别分层的表，占总表6049的40%，它们基本没办法复用。 重点是在已识别分层的读表任务中，ODS：DWD：DWS：ADS的读取任务分别是1072：545：187：433，直接读取ODS 层任务占这四层任务总和的47.9%，这说明有大量任务都是基于原始数据加工，中间模型复用性很差。</p><p>我们再来看看表2，在已识别的分层的查询中，ODS：DWD：DWS：ADS的命中的查询分别是892：1008：152：305，有37.8%的查询直接命中ODS层原始数据，说明DWD、DWS、ADS层数据建设缺失严重。尤其是ADS和DWS，查询越底层的表，就会导致查询扫描的数据量会越大，查询时间会越长，查询的资源消耗也越大，使用数据的人满意度会低。</p><p>最后，我们进一步对ODS层被读取的704张表进行分解，发现有382张表的下游产出是DWS，ADS，尤其是ADS达到了323张表，占ODS层表的比例45.8%，说明有大量ODS层表被进行物理深加工。</p><p><strong>通过上面的分析，我们似乎已经找到了一个理想的数仓模型设计应该具备的因素，那就是“数据模型可复用，完善且规范”。</strong></p><p><img src="/blog-backend/static/httpsstatic001geekbangorgresourceimaged6b3d6b10b27dfa4e4cff5a2ca496bd1fbb3.b30aeefb.jpg" alt=""/></p><h3 id="如何衡量完善度"><a aria-hidden="true" tabindex="-1" href="/blog-backend/数据中台实战课/03.实现篇/03#如何衡量完善度"><span class="icon icon-link"></span></a>如何衡量完善度</h3><p>**DWD 层完善度：**衡量DWD层是否完善，最好看ODS层有多少表被DWS/ADS/DM层引用。因为DWD以上的层引用的越多，就说明越多的任务是基于原始数据进行深度聚合计算的，明细数据没有积累，无法被复用，数据清洗、格式化、集成存在重复开发。因此，我提出用跨层引用率指标衡量DWD的完善度。</p><blockquote><p>跨层引用率：ODS层直接被DWS/ADS/DM层引用的表，占所有ODS层表（仅统计活跃表）比例。</p></blockquote><p>跨层引用率越低越好，在数据中台模型设计规范中，我们要求不允许出现跨层引用，ODS层数据只能被DWD 引用。</p><p>**DWS/ADS/DM 层完善度：**考核汇总数据的完善度，我认为主要看汇总数据能直接满足多少查询需求（也就是用汇总层数据的查询比例衡量）。如果汇总数据无法满足需求，使用数据的人就必须使用明细数据，甚至是原始数据。</p><blockquote><p>汇总数据查询比例：DWS/ADS/DM层的查询占所有查询的比例。</p></blockquote><p>你要明确的是，这个跟跨层引用率不同，汇总查询比例不可能做到100%，但值越高，说明上层的数据建设越完善，对于使用数据的人来说，查询速度和成本会减少，用起来会更爽。</p><h3 id="如何衡量复用度"><a aria-hidden="true" tabindex="-1" href="/blog-backend/数据中台实战课/03.实现篇/03#如何衡量复用度"><span class="icon icon-link"></span></a>如何衡量复用度</h3><p>数据中台模型设计的核心是追求模型的复用和共享，通过元数据中心的数据血缘图，我们可以看到，一个比较差的模型设计，自下而上是一条线。而一个理想的模型设计，它应该是交织的发散型结构。</p><p><img src="/blog-backend/static/httpsstatic001geekbangorgresourceimagee497e4038beaead8be1db13aa1c7299c2a97.b0f3cc88.jpg" alt=""/></p><p>我提出用模型引用系数作为指标，衡量数据中台模型设计的复用度。引用系数越高，说明数仓的复用性越好。</p><blockquote><p>模型引用系数：一个模型被读取，直接产出下游模型的平均数量。</p></blockquote><p>比如一张DWD层表被5张DWS 层表引用，这张DWD层表的引用系数就是5，如果把所有DWD层表（有下游表的）引用系数取平均值，则为DWD层表平均模型引用系数，一般低于2比较差，3以上相对比较好（经验值）。</p><h3 id="如何衡量规范度"><a aria-hidden="true" tabindex="-1" href="/blog-backend/数据中台实战课/03.实现篇/03#如何衡量规范度"><span class="icon icon-link"></span></a>如何衡量规范度</h3><p>表1中，超过40%的表都没有分层信息，在模型设计层面，这显然是不规范的。除了看这个表有没有分层，还要看它有没有归属到主题域（例如交易域）如果没有归属主题域，就很难找到这张表，也无法复用。</p><p>其次，你要看表的命名。拿stock这个命名为例，当你看到这个表时，知道它是哪个主题域、业务过程？是全量数据的表，还是每天的增量数据？总的来说，通过这个表名获取的信息太有限了。一个规范的表命名应该包括主题域、分层、表是全量快照，还是增量等信息。</p><p>除此之外，如果在表A中用户ID的命名是UserID，在表B中用户ID 命名是ID，就会对使用者造成困扰，这到底是不是一个东西。所以我们要求相同的字段在不同的模型中，它的命名必须是一致的。</p><p><strong>讲了这么多，你要如何吸收经验呢？在这里，我给你几点建议。</strong></p><ul><li>你可以拿着这些指标去评估一下，自己的数仓现状如何。</li><li>然后制订一些针对性的改进计划，比如把这些不规范命名的表消灭掉，把主题域覆盖的表比例提高到90%以上。</li><li>在尝试完一段时间的模型重构和优化后，再拿着这些指标去测一测是不是真的变好了。我见过很多数据开发在向上级汇报工作时，喜欢用重构了多少模型说明工作成果，很多老大会想，这些重构到底对数据建设有多少帮助？有没有一些量化的指标可以衡量？<strong>我想有上面的知识，你可以应对这个问题了。</strong></li></ul><p>现在你知道什么是好的数仓设计了，可目前已经存在了大量烟囱式开发，具体怎么做才能让它变成一个数据中台呢？</p><h2 id="如何从烟囱式的小数仓到共享的数据中台"><a aria-hidden="true" tabindex="-1" href="/blog-backend/数据中台实战课/03.实现篇/03#如何从烟囱式的小数仓到共享的数据中台"><span class="icon icon-link"></span></a>如何从烟囱式的小数仓到共享的数据中台</h2><p>建设数据中台本质就是构建企业的公共数据层，把原先分散的、烟囱式的、杂乱的小数仓，合并成一个可共享、可复用的数据中台（我在<a target="_blank" rel="noopener noreferrer" href="https://time.geekbang.org/column/article/220290">03讲<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="__dumi-default-external-link-icon"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>提到过，建议你回顾一下）。结合我在网易的实践经验，我给你几点建议。</p><p><strong>第一，接管ODS层，控制源头。</strong></p><p>ODS是业务数据进入数据中台的第一站，是所有数据加工的源头，控制住源头，才能从根本上防止一个重复的数据体系的出现。</p><p>数据中台团队必须明确职责，全面接管ODS 层数据，从业务系统的源数据库权限入手，确保数据从业务系统产生后进入数据仓库时，只能在数据中台保持一份。这个可以跟业务系统数据库管理者达成一致，只有中台团队的账号才能同步数据。</p><p>ODS层表的数据必须和数据源的表结构、表记录数一致，高度无损，对于ODS 层表的命名采用ODS_业务系统数据库名_业务系统数据库表名方式，比如ods_warehous_stock，warehous是业务系统数据库名，stock是该库下面的表名。</p><p><strong>第二，划分主题域，构建总线矩阵。</strong></p><p>主题域是业务过程的抽象集合。可能这么讲，稍微有点儿抽象，但其实业务过程就是企业经营过程中一个个不可拆分的行为事件，比如仓储管理里面有入库、出库、发货、签收，都是业务过程，抽象出来的主题域就是仓储域。</p><p><img src="/blog-backend/static/httpsstatic001geekbangorgresourceimage17cc1724055dd6eb3911cee9084d9a674ecc.8f7353cb.jpg" alt="" title="表3 电商业务的主题域划分"/></p><p>主题域划分要尽量涵盖所有业务需求，保持相对稳定性，还具备一定的扩展性（新加入一个主题域，不影响已经划分的主题域的表）。</p><p>主题域划分好以后，就要开始构建总线矩阵，明确每个主题域下的业务过程有哪些分析维度，举个例子：</p><p><img src="/blog-backend/static/httpsstatic001geekbangorgresourceimage34ec348e85b3a97e90345df4bce09cbf5aec.00848efb.jpg" alt="" title="表4 交易域的总线矩阵"/></p><p><strong>第三，构建一致性维度。</strong></p><p>售后团队的投诉工单数量有针对地区的分析维度，而配送团队的配送延迟也有针对地区的分析维度，你想分析因为配送延迟导致的投诉增加，但是两个地区的分析维度包含内容不一致，最终会导致一些地区没办法分析。所以我们构建全局一致性的维表，确保维表只存一份。</p><p>**维度统一的最大的难题在于维度属性（如果维度是商品，那么商品类别、商品品牌、商品尺寸等商品的属性，我们称为维度属性）的整合。**是不是所有维度属性都要整合到一个大的维表中，也不见得，我给你几个建议。</p><ul><li><p>公共维度属性与特有维度属性拆成两个维表。在自营平台中，通常也会有一些第三方的商家入驻，但是数量很少。大部分商品其实都没有店铺的属性，这种情况，就不建议将店铺和商品的其他维度属性，比如商品类别、品牌设计成一个维表。</p></li><li><p>产出时间相差较大的维度属性拆分单独的维表，比如有些维度属性产出时间在凌晨2点，有些维度属性产出时间在凌晨6点，那2点和6点的就可以拆成两个维表，确保核心维表尽早产出。</p></li><li><p>出于维表稳定性产出的考虑，你可以将更新频繁的和变化缓慢的进行拆分，访问频繁的和访问较少的维表进行拆分。</p></li></ul><p>对于维表的规范化命名，建议你用“DIM_主题域_描述_分表规则”方式。**分表你可以这样理解：**一个表存储几千亿行记录实在是太大了，所以需要把一个表切割成很多小的分区，每天或者每周，随着任务被调度，会生成一个分区。我提供给你一个常见的分区规则（这个规则你在用的时候，查阅就可以了）。</p><p><img src="/blog-backend/static/httpsstatic001geekbangorgresourceimageffb9ff40520c4716d28ca0d220a997f819b9.298b3c98.jpg" alt=""/></p><p><strong>第四，事实表整合。</strong></p><p>我觉得事实表整合遵循的最基本的一个原则是，统计粒度必须保持一致，不同统计粒度的数据不能出现在同一个事实表中。来看一个例子：</p><p><img src="/blog-backend/static/httpsstatic001geekbangorgresourceimage7897789d5b5f83405eba77e8cdbb6b1ce997.6e0ea730.jpg" alt=""/></p><p>在数据中台构建前，供应链部门、仓储部门和市场部门都有一些重复的事实表，我们需要将这些重复的内容进行去除，按照交易域和仓储域，主题域的方式进行整合。</p><p><img src="/blog-backend/static/httpsstatic001geekbangorgresourceimagecb55cb15353c0724c59ab0b24b64057cb055.a6499a1d.jpg" alt=""/></p><p>对于仓储部门和供应链部门都有的库存明细表，因为仓储部门的统计粒度是商品加仓库，而供应链部门的只有商品，所以原则上两个表是不能合并，而是应该独立存在。</p><p><img src="/blog-backend/static/httpsstatic001geekbangorgresourceimagefe5bfe81e5b9a4f290563b850d73022a865b.2fcc0911.jpg" alt=""/></p><p>对于市场部门和供应链部门的两张下单明细表，因为统计粒度都是订单级别，都归属于交易域下的下单业务过程，所以可以合并为一张事实表。</p><p>除此之外，还应该考虑将不全的数据补齐。对于ODS 层直接被引用产出DWS/ADS/DM层的任务，通过血缘，找到任务清单，逐个进行拆解。没有ODS对应的DWD的，应该生成DWD表，对于已经存在的，应该迁移任务，使用DWD层表。</p><p><img src="/blog-backend/static/httpsstatic001geekbangorgresourceimagec3c5c3f514d99386ad2731f4d50d8b3ed8c5.bb6550ed.jpg" alt=""/></p><p>DWD/DWS/ADS/DM的命名规则适合采用“[层次][主题][子主题][内容描述][分表规则]”的命名方式。</p><p><strong>第五，模型开发。</strong></p><p>模型设计完成后，就进入模型开发阶段，我想提几个你需要注意的点：</p><ol><li>所有任务都必须严格配置任务依赖，如果没有配置任务依赖，会导致前一个任务没有正常产出数据的情况下，后一个任务被调度起来，基于错误的数据空跑，浪费资源，同时增加了排查故障的复杂度；</li><li>任务中创建的临时表，在任务结束前应该删除，如果不删除，会发现有大量的临时表存在，占用空间；</li><li>任务名称最好跟表名一致，方便查找和关联；</li><li>生命周期的管理，对于ODS和DWD，一般尽可能保留所有历史数据，对于<br/>DWS/ADS/DM 需要设置生命周期，7～30天不等；</li><li>DWD 层表宜采用压缩的方式存储，可用lzo压缩。</li></ol><p><strong>第六，应用迁移。</strong></p><p>最后一步就是应用的迁移，这个过程的核心是要注意数据的比对，确保数据的完全一致，然后进行应用迁移，删除老的数据表。</p><p>总的来说，建设数据中台不是一口气就能吃成一个胖子，它的建设往往是滚雪球的方式，随着一个个应用的迁移，中台的数据也越来越丰满，发挥的价值也越来越大。</p><h2 id="数仓建模工具easydesign"><a aria-hidden="true" tabindex="-1" href="/blog-backend/数据中台实战课/03.实现篇/03#数仓建模工具easydesign"><span class="icon icon-link"></span></a>数仓建模工具EasyDesign</h2><p>当然了，这些步骤的实现，离不开一个好用的工具作为支撑，为了规范化数据模型的设计，我们研发了EasyDesign的模型设计产品，让这些流程实现系统化管理。而我希望你了解如何去设计这个工具，或者在选用工具的时候应该考虑有哪些功能。</p><p><img src="/blog-backend/static/httpsstatic001geekbangorgresourceimage74b574c84414f5e004cbc1351c6e77d1e0b5.78cd4bf8.jpg" alt=""/></p><p>EasyDesign 构建于元数据中心之上，通过API调用元数据中心的数据血缘接口，结合数仓模型设计的指标，给出了模型设计度量。</p><p><img src="/blog-backend/static/httpsstatic001geekbangorgresourceimage64046493f76676d8d40beb8a84c2554d0a04.d76178cb.jpg" alt=""/></p><p>EasyDesign按照主题域、业务过程、分层的方式管理所有的模型。</p><p><img src="/blog-backend/static/httpsstatic001geekbangorgresourceimage50bc50849628d758e95666ee5d3cce9ed7bc.cb40aa0f.jpg" alt=""/></p><p>它还提供了维度、度量和字段基础字典的管理，同时具备模型设计审批流程的控制。</p><h2 id="课堂总结"><a aria-hidden="true" tabindex="-1" href="/blog-backend/数据中台实战课/03.实现篇/03#课堂总结"><span class="icon icon-link"></span></a>课堂总结</h2><p>本节课，我结合自己的经验，带你了解了数据中台的模型设计。从确立设计目标，到通过一系列步骤，将一个个分散的、杂乱的、烟囱式的小数仓逐步规整到一个可复用、可共享的数据中台，最后通过产品化的方式实现系统化的管理。在最后，我想再强调几个点：</p><ul><li>完善度、复用度和规范度构成了衡量数据中台模型设计的度量体系，可以帮助你评估数仓设计的好坏。</li><li>维度设计是维度建模的灵魂，也是数据中台模型设计的基础，维度设计的核心是构建一致性维度。</li><li>事实表的统计粒度必须保持一致，不同统计粒度的数据不能出现在同一个事实表中。</li></ul><p>你要知道，数据中台的构建往往需要花费半年甚至一年以上的时间，但是数据中台建成后，对研发效率的提升效果非常明显，在网易电商业务中，中台构建后相比构建前，数据需求的平均交付时间从一周缩短到3天内，需求响应速度的提升，为企业运营效果提升提供了数据支撑。我相信通过数据中台的构建，你所在企业的数据研发效率也会得到大幅度的提升。</p><p><img src="/blog-backend/static/httpsstatic001geekbangorgresourceimage054b056037d1806f48243643a3689a89e14b.f5f81b43.jpg" alt=""/></p><h2 id="思考时间"><a aria-hidden="true" tabindex="-1" href="/blog-backend/数据中台实战课/03.实现篇/03#思考时间"><span class="icon icon-link"></span></a>思考时间</h2><p>在数据中台实际实施落地的过程中，数据团队不但要建设公共数据层，形成数据中台，还要承担着巨大的新需求的压力。而且，往往需求的优先级都高于建设公共数据层的优先级，导致中台建设的进度难以保障。 对这个问题，你有什么解决方法呢？</p><p>最好，感谢你的阅读，如果这节课让你有所收获，也欢迎你将它分享给更多的朋友。</p></div><div class="__dumi-default-layout-footer-meta"><a target="_blank" rel="noopener noreferrer" href="https://github.com/GGwujun/blog/edit/master/ssrc/数据中台实战课/03.实现篇/03.md">在 GitHub 上编辑此页<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="__dumi-default-external-link-icon"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a><span data-updated-text="最后更新时间：">2023/9/27 11:15:40</span></div></div></div></div>
	<script>
  window.g_useSSR = true;
  window.g_initialProps = {};
	</script>

    <script>
      (function () {
        if (!location.port) {
          (function (i, s, o, g, r, a, m) {
            i["GoogleAnalyticsObject"] = r;
            (i[r] =
              i[r] ||
              function () {
                (i[r].q = i[r].q || []).push(arguments);
              }),
              (i[r].l = 1 * new Date());
            (a = s.createElement(o)), (m = s.getElementsByTagName(o)[0]);
            a.async = 1;
            a.src = g;
            m.parentNode.insertBefore(a, m);
          })(
            window,
            document,
            "script",
            "//www.google-analytics.com/analytics.js",
            "ga"
          );
          ga("create", "UA-149864185-1", "auto");
          ga("send", "pageview");
        }
      })();
    </script>
    <script src="/blog-backend/umi.e14e5a14.js"></script>
  </body>
</html>
