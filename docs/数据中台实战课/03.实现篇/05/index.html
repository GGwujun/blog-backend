<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1, maximum-scale=1, minimum-scale=1, user-scalable=no"
    />
    <link rel="shortcut icon" type="image/x-icon" href="/logo.png" />
    <link rel="stylesheet" href="/blog-backend/umi.3ec1f225.css" />
    <script>
      window.routerBase = "/blog-backend";
    </script>
    <script>
      //! umi version: 3.5.41
    </script>
    <script>
      !(function () {
        var e =
            navigator.cookieEnabled && void 0 !== window.localStorage
              ? localStorage.getItem("dumi:prefers-color")
              : "auto",
          o = window.matchMedia("(prefers-color-scheme: dark)").matches,
          t = ["light", "dark", "auto"];
        document.documentElement.setAttribute(
          "data-prefers-color",
          e === t[2] ? (o ? t[1] : t[0]) : t.indexOf(e) > -1 ? e : t[0]
        );
      })();
    </script>
    <title>08 | 交付速度和质量问题解决了，老板说还得“省” - 大师兄</title>
  </head>
  <body>
    <div id="root"><div class="__dumi-default-layout" data-route="/数据中台实战课/03.实现篇/05" data-show-sidemenu="true" data-show-slugs="true" data-site-mode="true" data-gapless="false"><div class="__dumi-default-navbar" data-mode="site"><button class="__dumi-default-navbar-toggle"></button><a class="__dumi-default-navbar-logo" style="background-image:url(&#x27;/logo.png&#x27;)" href="/blog-backend/">大师兄</a><nav><div class="__dumi-default-search"><input type="search" class="__dumi-default-search-input" value=""/><ul></ul></div><span>后端开发<ul><li><a href="/blog-backend/go语言核心36讲">go语言核心36讲</a></li><li><a href="/blog-backend/go并发编程实战">go并发编程实战</a></li><li><a href="/blog-backend/go语言项目开发实战">go语言项目开发实战</a></li><li><a href="/blog-backend/kafka核心技术与实战">kafka核心技术与实战</a></li><li><a href="/blog-backend/kafka核心源码解读">kafka核心源码解读</a></li><li><a href="/blog-backend/零基础学python">零基础学python</a></li><li><a href="/blog-backend/python核心技术与实战">python核心技术与实战</a></li><li><a href="/blog-backend/redis核心技术与实战">redis核心技术与实战</a></li><li><a href="/blog-backend/redis源码剖析与实战">redis源码剖析与实战</a></li><li><a href="/blog-backend/陈天rust编程第一课">陈天rust编程第一课</a></li><li><a href="/blog-backend/tonybaigo语言第一课">tonybaigo语言第一课</a></li><li><a href="/blog-backend/后端存储实战课">后端存储实战课</a></li><li><a href="/blog-backend/后端技术面试38讲">后端技术面试38讲</a></li><li><a href="/blog-backend/深入c语言和程序运行原理">深入c语言和程序运行原理</a></li><li><a href="/blog-backend/现代c编程实战">现代c编程实战</a></li><li><a href="/blog-backend/罗剑锋的c实战笔记">罗剑锋的c实战笔记</a></li><li><a href="/blog-backend/零基础入门spark">零基础入门spark</a></li></ul></span><span>架构师<ul><li><a href="/blog-backend/mysql实战45讲">mysql实战45讲</a></li><li><a aria-current="page" class="active" href="/blog-backend/数据中台实战课">数据中台实战课</a></li></ul></span><div class="__dumi-default-navbar-tool"><div class="__dumi-default-dark"><div class="__dumi-default-dark-switch "></div></div></div></nav></div><div class="__dumi-default-menu" data-mode="site"><div class="__dumi-default-menu-inner"><div class="__dumi-default-menu-header"><a class="__dumi-default-menu-logo" style="background-image:url(&#x27;/logo.png&#x27;)" href="/blog-backend/"></a><h1>大师兄</h1><p></p></div><div class="__dumi-default-menu-mobile-area"><ul class="__dumi-default-menu-nav-list"><li>后端开发<ul><li><a href="/blog-backend/go语言核心36讲">go语言核心36讲</a></li><li><a href="/blog-backend/go并发编程实战">go并发编程实战</a></li><li><a href="/blog-backend/go语言项目开发实战">go语言项目开发实战</a></li><li><a href="/blog-backend/kafka核心技术与实战">kafka核心技术与实战</a></li><li><a href="/blog-backend/kafka核心源码解读">kafka核心源码解读</a></li><li><a href="/blog-backend/零基础学python">零基础学python</a></li><li><a href="/blog-backend/python核心技术与实战">python核心技术与实战</a></li><li><a href="/blog-backend/redis核心技术与实战">redis核心技术与实战</a></li><li><a href="/blog-backend/redis源码剖析与实战">redis源码剖析与实战</a></li><li><a href="/blog-backend/陈天rust编程第一课">陈天rust编程第一课</a></li><li><a href="/blog-backend/tonybaigo语言第一课">tonybaigo语言第一课</a></li><li><a href="/blog-backend/后端存储实战课">后端存储实战课</a></li><li><a href="/blog-backend/后端技术面试38讲">后端技术面试38讲</a></li><li><a href="/blog-backend/深入c语言和程序运行原理">深入c语言和程序运行原理</a></li><li><a href="/blog-backend/现代c编程实战">现代c编程实战</a></li><li><a href="/blog-backend/罗剑锋的c实战笔记">罗剑锋的c实战笔记</a></li><li><a href="/blog-backend/零基础入门spark">零基础入门spark</a></li></ul></li><li>架构师<ul><li><a href="/blog-backend/mysql实战45讲">mysql实战45讲</a></li><li><a aria-current="page" class="active" href="/blog-backend/数据中台实战课">数据中台实战课</a></li></ul></li></ul><div class="__dumi-default-dark"><div class="__dumi-default-dark-switch "><button title="Dark theme" class="__dumi-default-dark-moon "><svg viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="3854" width="22" height="22"><path d="M991.816611 674.909091a69.166545 69.166545 0 0 0-51.665455-23.272727 70.795636 70.795636 0 0 0-27.438545 5.585454A415.674182 415.674182 0 0 1 754.993338 698.181818c-209.594182 0-393.472-184.785455-393.472-395.636363 0-52.363636 38.539636-119.621818 69.515637-173.614546 4.887273-8.610909 9.634909-16.756364 14.103272-24.901818A69.818182 69.818182 0 0 0 384.631156 0a70.842182 70.842182 0 0 0-27.438545 5.585455C161.678429 90.298182 14.362065 307.898182 14.362065 512c0 282.298182 238.824727 512 532.38691 512a522.286545 522.286545 0 0 0 453.957818-268.334545A69.818182 69.818182 0 0 0 991.816611 674.909091zM546.679156 954.181818c-248.785455 0-462.941091-192-462.941091-442.181818 0-186.647273 140.637091-372.829091 300.939637-442.181818-36.817455 65.629091-92.578909 151.970909-92.578909 232.727273 0 250.181818 214.109091 465.454545 462.917818 465.454545a488.331636 488.331636 0 0 0 185.181091-46.545455 453.003636 453.003636 0 0 1-393.565091 232.727273z m103.656728-669.323636l-14.266182 83.781818a34.909091 34.909091 0 0 0 50.362182 36.770909l74.775272-39.563636 74.752 39.563636a36.142545 36.142545 0 0 0 16.174546 3.956364 34.909091 34.909091 0 0 0 34.210909-40.727273l-14.289455-83.781818 60.509091-59.345455a35.025455 35.025455 0 0 0-19.223272-59.578182l-83.61891-12.101818-37.376-76.101818a34.56 34.56 0 0 0-62.254545 0l-37.376 76.101818-83.618909 12.101818a34.909091 34.909091 0 0 0-19.246546 59.578182z m70.423272-64.698182a34.280727 34.280727 0 0 0 26.135273-19.083636l14.312727-29.090909 14.336 29.090909a34.257455 34.257455 0 0 0 26.135273 19.083636l32.046546 4.887273-23.272728 22.574545a35.234909 35.234909 0 0 0-10.007272 30.952727l5.46909 32.116364-28.625454-15.127273a34.490182 34.490182 0 0 0-32.302546 0l-28.695272 15.127273 5.469091-32.116364a35.141818 35.141818 0 0 0-9.984-30.952727l-23.272728-22.574545z" p-id="3855"></path></svg></button><button title="Light theme" class="__dumi-default-dark-sun "><svg viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="4026" width="22" height="22"><path d="M915.2 476.16h-43.968c-24.704 0-44.736 16-44.736 35.84s20.032 35.904 44.736 35.904H915.2c24.768 0 44.8-16.064 44.8-35.904s-20.032-35.84-44.8-35.84zM512 265.6c-136.704 0-246.464 109.824-246.464 246.4 0 136.704 109.76 246.464 246.464 246.464S758.4 648.704 758.4 512c0-136.576-109.696-246.4-246.4-246.4z m0 425.6c-99.008 0-179.2-80.128-179.2-179.2 0-98.944 80.192-179.2 179.2-179.2S691.2 413.056 691.2 512c0 99.072-80.192 179.2-179.2 179.2zM197.44 512c0-19.84-19.136-35.84-43.904-35.84H108.8c-24.768 0-44.8 16-44.8 35.84s20.032 35.904 44.8 35.904h44.736c24.768 0 43.904-16.064 43.904-35.904zM512 198.464c19.776 0 35.84-20.032 35.84-44.8v-44.8C547.84 84.032 531.84 64 512 64s-35.904 20.032-35.904 44.8v44.8c0 24.768 16.128 44.864 35.904 44.864z m0 627.136c-19.776 0-35.904 20.032-35.904 44.8v44.736C476.096 940.032 492.16 960 512 960s35.84-20.032 35.84-44.8v-44.736c0-24.768-16.064-44.864-35.84-44.864z m329.92-592.832c17.472-17.536 20.288-43.072 6.4-57.024-14.016-14.016-39.488-11.2-57.024 6.336-4.736 4.864-26.496 26.496-31.36 31.36-17.472 17.472-20.288 43.008-6.336 57.024 13.952 14.016 39.488 11.2 57.024-6.336 4.8-4.864 26.496-26.56 31.296-31.36zM213.376 759.936c-4.864 4.8-26.56 26.624-31.36 31.36-17.472 17.472-20.288 42.944-6.4 56.96 14.016 13.952 39.552 11.2 57.024-6.336 4.8-4.736 26.56-26.496 31.36-31.36 17.472-17.472 20.288-43.008 6.336-56.96-14.016-13.952-39.552-11.072-56.96 6.336z m19.328-577.92c-17.536-17.536-43.008-20.352-57.024-6.336-14.08 14.016-11.136 39.488 6.336 57.024 4.864 4.864 26.496 26.56 31.36 31.424 17.536 17.408 43.008 20.288 56.96 6.336 14.016-14.016 11.264-39.488-6.336-57.024-4.736-4.864-26.496-26.56-31.296-31.424z m527.168 628.608c4.864 4.864 26.624 26.624 31.36 31.424 17.536 17.408 43.072 20.224 57.088 6.336 13.952-14.016 11.072-39.552-6.4-57.024-4.864-4.8-26.56-26.496-31.36-31.36-17.472-17.408-43.072-20.288-57.024-6.336-13.952 14.016-11.008 39.488 6.336 56.96z" p-id="4027"></path></svg></button><button title="Default to system" class="__dumi-default-dark-auto "><svg viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="11002" width="22" height="22"><path d="M127.658667 492.885333c0-51.882667 10.24-101.717333 30.378666-149.162666s47.786667-88.064 81.92-122.538667 75.093333-61.781333 122.538667-81.92 96.938667-30.378667 149.162667-30.378667 101.717333 10.24 149.162666 30.378667 88.405333 47.786667 122.88 81.92 61.781333 75.093333 81.92 122.538667 30.378667 96.938667 30.378667 149.162666-10.24 101.717333-30.378667 149.162667-47.786667 88.405333-81.92 122.88-75.093333 61.781333-122.88 81.92-97.28 30.378667-149.162666 30.378667-101.717333-10.24-149.162667-30.378667-88.064-47.786667-122.538667-81.92-61.781333-75.093333-81.92-122.88-30.378667-96.938667-30.378666-149.162667z m329.045333 0c0 130.048 13.994667 244.394667 41.984 343.381334h12.970667c46.762667 0 91.136-9.216 133.461333-27.306667s78.848-42.666667 109.568-73.386667 54.954667-67.242667 73.386667-109.568 27.306667-86.698667 27.306666-133.461333c0-46.421333-9.216-90.794667-27.306666-133.12s-42.666667-78.848-73.386667-109.568-67.242667-54.954667-109.568-73.386667-86.698667-27.306667-133.461333-27.306666h-11.605334c-28.672 123.562667-43.349333 237.909333-43.349333 343.722666z" p-id="11003"></path></svg></button></div></div></div><ul class="__dumi-default-menu-list"><li><a href="/blog-backend/数据中台实战课">数据中台实战课</a></li><li><a href="/blog-backend/数据中台实战课/01.开篇词">01.开篇词</a><ul><li><a href="/blog-backend/数据中台实战课/01.开篇词/01"><span>开篇词  | 数据中台，是陷阱？还是金钥匙？</span></a></li></ul></li><li><a href="/blog-backend/数据中台实战课/02.原理篇">02.原理篇</a><ul><li><a href="/blog-backend/数据中台实战课/02.原理篇/01"><span>01 | 前因后果：为什么说数据中台是大数据的下一站？</span></a></li><li><a href="/blog-backend/数据中台实战课/02.原理篇/02"><span>02 | 关键抉择： 到底什么样的企业应该建数据中台？</span></a></li><li><a href="/blog-backend/数据中台实战课/02.原理篇/03"><span>03 | 数据中台建设三板斧：方法论、组织和技术</span></a></li><li><a href="/blog-backend/数据中台实战课/02.原理篇/04"><span>特别放送｜史凯：建设数据中台到底有什么用？</span></a></li></ul></li><li><a aria-current="page" class="active" href="/blog-backend/数据中台实战课/03.实现篇">03.实现篇</a><ul><li><a href="/blog-backend/数据中台实战课/03.实现篇/01"><span>04 | 元数据中心的关键目标和技术实现方案</span></a></li><li><a href="/blog-backend/数据中台实战课/03.实现篇/02"><span>05 | 如何统一管理纷繁杂乱的数据指标？</span></a></li><li><a href="/blog-backend/数据中台实战课/03.实现篇/03"><span>06 |  数据模型无法复用，归根结底还是设计问题</span></a></li><li><a href="/blog-backend/数据中台实战课/03.实现篇/04"><span>07 | 同事老打脸说数据有问题，该怎么彻底解决？</span></a></li><li><a aria-current="page" class="active" href="/blog-backend/数据中台实战课/03.实现篇/05"><span>08 | 交付速度和质量问题解决了，老板说还得“省”</span></a></li><li><a href="/blog-backend/数据中台实战课/03.实现篇/06"><span>09 | 数据服务到底解决了什么问题？</span></a></li><li><a href="/blog-backend/数据中台实战课/03.实现篇/07"><span>10 | 数据服务难道就是对外提供个API吗？</span></a></li><li><a href="/blog-backend/数据中台实战课/03.实现篇/08"><span>11 | 怎么一劳永逸地解决数据安全问题？</span></a></li><li><a href="/blog-backend/数据中台实战课/03.实现篇/09"><span>12 | 数据的台子搭完了，但你还得想好戏该怎么唱</span></a></li><li><a href="/blog-backend/数据中台实战课/03.实现篇/10"><span>13 | 数据研发就只是写代码吗？</span></a></li><li><a href="/blog-backend/数据中台实战课/03.实现篇/11"><span>14 | 数据被加工后，你还要学会使用和管理数据</span></a></li><li><a href="/blog-backend/数据中台实战课/03.实现篇/12"><span>15 | 数据中台在网易电商业务的最佳实践</span></a></li></ul></li><li><a href="/blog-backend/数据中台实战课/04.结束语">04.结束语</a><ul><li><a href="/blog-backend/数据中台实战课/04.结束语/01"><span>结课测试 | 建设数据中台的这些知识，你都掌握了吗？</span></a></li><li><a href="/blog-backend/数据中台实战课/04.结束语/02"><span>结束语 | 数据中台从哪里来，要到哪里去？</span></a></li></ul></li><li><a href="/blog-backend/数据中台实战课/summary">数据中台实战课</a></li></ul></div></div><ul role="slug-list" class="__dumi-default-layout-toc"><li title="有哪些成本的陷阱？" data-depth="2"><a href="/blog-backend/数据中台实战课/03.实现篇/05#有哪些成本的陷阱"><span>有哪些成本的陷阱？</span></a></li><li title="如何实现精细化成本管理？" data-depth="2"><a href="/blog-backend/数据中台实战课/03.实现篇/05#如何实现精细化成本管理"><span>如何实现精细化成本管理？</span></a></li><li title="全局资产盘点" data-depth="3"><a href="/blog-backend/数据中台实战课/03.实现篇/05#全局资产盘点"><span>全局资产盘点</span></a></li><li title="发现问题" data-depth="3"><a href="/blog-backend/数据中台实战课/03.实现篇/05#发现问题"><span>发现问题</span></a></li><li title="治理优化" data-depth="3"><a href="/blog-backend/数据中台实战课/03.实现篇/05#治理优化"><span>治理优化</span></a></li><li title="治理效果评估" data-depth="3"><a href="/blog-backend/数据中台实战课/03.实现篇/05#治理效果评估"><span>治理效果评估</span></a></li><li title="成本治理中心" data-depth="2"><a href="/blog-backend/数据中台实战课/03.实现篇/05#成本治理中心"><span>成本治理中心</span></a></li><li title="课堂总结" data-depth="2"><a href="/blog-backend/数据中台实战课/03.实现篇/05#课堂总结"><span>课堂总结</span></a></li><li title="思考时间" data-depth="2"><a href="/blog-backend/数据中台实战课/03.实现篇/05#思考时间"><span>思考时间</span></a></li></ul><div class="__dumi-default-layout-content"><div class="markdown"><h1 id="08--交付速度和质量问题解决了老板说还得省"><a aria-hidden="true" tabindex="-1" href="/blog-backend/数据中台实战课/03.实现篇/05#08--交付速度和质量问题解决了老板说还得省"><span class="icon icon-link"></span></a>08 | 交付速度和质量问题解决了，老板说还得“省”</h1><p>你好，我是郭忆。</p><p>在上一节课中，我们讨论了如何保障数据中台的数据质量，让数据做到“准”。我认为，除了“快”和“准”，数据中台还离不开一个“省”字。尤其是随着数据规模越来越大，成本越来越高，如果不能合理控制成本，还没等你挖掘出数据的应用价值，企业利润就已经被消耗完了。</p><p>所以，能否做到精细化的成本管理，关乎数据中台项目的成败。还是分享一个我见过的事儿。</p><p><img src="data:image/png;base64,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" alt="" title="某电商业务数据建设资源增长趋势（CU= 1vcpu + 4G memory）"/></p><p>这张图展示了某电商平台的大数据资源消耗增长趋势，尤其值得你关注的是，到了2019年，全年的资源规模已经达到了25000CU，全年机器预算达到了3500W。对一个在创业的企业来说，这显然是一笔不小的开支。</p><p>终于有一天，数据团队的负责人李好看（化名）就被CEO叫到了办公室，CEO问了几个问题：</p><ul><li>这3500W花在什么业务上？</li><li>你们做了哪些成本优化的举措，效果如何？</li></ul><p>一系列的灵魂拷问，直接把李好看问懵了，他心想：团队的成本是按机器又不是数据应用核算的。在数据中台中，数据应用之间的底层数据是复用的，那具体每个数据产品或者报表花了多少钱，自己没有这样的数据啊，怎么可能知道。</p><p>可对CEO来说，这些问题很重要，因为资源总是有限的，他必须确保资源都用在战略目标的关键节点上。比如，对于电商团队，今年的核心KPI是提升单个注册会员在平台的消费额，那从老板角度来讲，他必须确保资源都投入与KPI相关业务中，例如基于数据对注册会员进行精准化营销，来提升会员在平台的消费额。</p><p>讲到这儿，你可以想一想，自己所在的团队是否发生过类似的事情？ 我相信，数据部门是企业的成本中心，如果要展现自己的价值，一方面是支撑好业务，获得业务的认可；另外一方面就是精简成本，为公司省钱。</p><p>所以，今天我们就把重点放在省钱上，聊一聊数据中台的精细化成本管理。</p><h2 id="有哪些成本的陷阱"><a aria-hidden="true" tabindex="-1" href="/blog-backend/数据中台实战课/03.实现篇/05#有哪些成本的陷阱"><span class="icon icon-link"></span></a>有哪些成本的陷阱？</h2><p>在一开始建设数据中台时，你往往会关注新业务的接入，数据的整合，数据价值的挖掘上，忽略成本管控的问题，从而落入陷阱中，造成成本爆炸式的增长。所以，你有必要深入了解一下有哪些陷阱，从而尽量在日常开发中避免。</p><p>在这里，我总结了8种陷阱，其中：</p><ul><li>1~3是广泛存在，但是容易被忽略的，需要你格外注意；</li><li>4~8涉及数据开发中一些技能，你在开发过程中注意一下就可以了。</li></ul><p>除此之外，在学习这部分知识的过程中，我建议你“知其然，更要知其所以然”，这样才能发现问题的本质，从而深入掌握解决问题的方法。</p><p><strong>第一，数据上线容易下线难。</strong></p><p><img src="/blog-backend/static/httpsstatic001geekbangorgresourceimagee55de5db0e377d41724e387a0d2fc0e8bb5d.4665e1f9.png" alt=""/></p><p>先来看一组统计数据，这是某数据中台项目，表相关的使用统计。从中你可以发现，有一半的表在30天内都没有访问，而这些表占用了26%的存储空间。如果我们把这些表的产出任务单独拎出来，在高峰期需要消耗5000Core CPU的计算资源，换算成服务器需要125台（按照一台服务器可分配CPU 40Core计算），折合成本一年接近500W。</p><p>是不是觉得自己竟然有这么多没用的数据？我经常把数据比作手机中的图片，我们总是不断地拍照，生成图片，却懒得清理，最终手机里面的存储经常不够用。</p><p>对于无法及时清理数据，数据开发其实也有苦衷。他们并不知道一个表还有哪些任务在引用，还有哪些人在查询，自然不敢停止这个表的数据加工，那造成的后果就是数据上线容易，下线难。</p><p><strong>第二，低价值的数据应用消耗了大量的资源。</strong></p><p>我们的数据看上去每天都在被访问，但究竟产出了多少价值，投入和产出是否匹配呢？作为一个数据部门，我们要问一问自己。</p><p>我们曾经有一个宽表（拥有很多列的表，经常出现在数据中台下游的汇总层数据中），算上上游加工链路的任务，每天加工这张宽表要消耗6000块钱，一年要200W，可追查后我们发现，这张宽表实际每天只有一个人在使用，还是一个运营的实习生。显然，投入和产出极不匹配。</p><p>这其实间接说明，数据部门比较关注新的数据产品带给业务的价值，却忽略了已经存在的产品或者报表是否还存在价值，最终导致低价值的应用仍然在大量消耗资源。</p><p><strong>第三，烟囱式的开发模式。</strong></p><p>烟囱式的开发不仅会带来研发效率低的问题，同时因为数据重复加工，还会存在资源浪费的问题。我们来算一笔账，一张500T的表，加工这张表，计算任务需要高峰期消耗300Core，折合7台服务器（按照一台服务器可分配CPU 40Core计算），再加上存储盘的成本(按照0.7 元/TB*天计算)，一年需要消耗40W。</p><p>而这张表每复用一次，就可以节省40W的成本。所以通过模型复用，还可以实现省钱的目的。</p><p><strong>第四，数据倾斜。</strong></p><p>数据倾斜会让任务性能变差，也会浪费大量的资源，那什么是数据倾斜呢？</p><p><img src="/blog-backend/static/httpsstatic001geekbangorgresourceimage83c883bb148a5b12651be930df928d170fc8.b1db19aa.jpg" alt="" title="单Stage阶段Spark任务数据分片运行图"/></p><p>你肯定听说过木桶效应吧？一个木桶装多少水，主要取决于最短的那块板。对于一个分布式并行计算框架来说，这个效应同样存在。对于Spark计算引擎来说，它可以将海量的数据切分成不同的分片（Partition），分配到不同机器运行的任务中，进行并行计算，从而实现计算能力水平扩展。</p><p>但是整个任务的运行时长，其实取决于运行最长的那个任务。因为每个分片的数据量可能不同，每个任务需要的资源也不相同。由于不同的任务不能分配不同的资源，所以，总任务消耗资源=max<!-- -->{<!-- -->单个任务消耗的资源<!-- -->}<!-- --> * 任务数量。这样一来，数据量小的任务会消耗更多的资源，就会造成资源的浪费。</p><p>我们还是举个电商场景的例子。</p><p>假设你需要按照商户粒度统计每个商户的交易金额，此时，我们需要对订单流水表按照商户进行group by计算。在平台上，每个商户的订单交易量实际差距很大，有的订单交易量很多，有的却比较少。</p><p><img src="/blog-backend/static/httpsstatic001geekbangorgresourceimagef2a9f267e8c7f4d1b03ff464e349cbd98ba9.aa1335c4.jpg" alt=""/></p><p>我们利用Spark SQL完成计算过程。</p><p><img src="/blog-backend/static/httpsstatic001geekbangorgresourceimage110c1152306e695043efba993f303e31720c.7f369943.jpg" alt="" title="数据倾斜示意图"/></p><p>在上图中，任务A 读取了左边某个分片的数据，按照供应商进行聚合，然后输出给下一个Stage的B、C、D任务。</p><p>你可以看到，聚合后，B、C和D任务输入的数据量有很大的不同，B处理的数据量比C和D多，消耗的内存自然更多，假设单个Executor需要分配16G，而B、C、D不能设置不同的内存大小，所以C和D也都设置了16G。可实际上，按照C和D的数据量，只需要4G就够了。这就造成了C和D 任务资源分配的浪费。</p><p><strong>第五，数据未设置生命周期。</strong></p><p>在<a target="_blank" rel="noopener noreferrer" href="https://time.geekbang.org/column/article/224516">06讲<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="__dumi-default-external-link-icon"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>中，我强调，一般原始数据和明细数据，会保留完整的历史数据。而在汇总层、集市层或者应用层，考虑到存储成本，数据建议按照生命周期来管理，通常保留几天的快照或者分区。如果存在大表没有设置生命周期，就会浪费存储资源。</p><p><strong>第六，调度周期不合理。</strong></p><p><img src="/blog-backend/static/httpsstatic001geekbangorgresourceimage9152913db7534374e4da5b2bf1a4c2f84052.a894918e.png" alt=""/></p><p>通过这张图你可以看到，大数据任务的资源消耗有很明显的高峰和低谷效应，一般晚上12点到第二天的9点是高峰期，9点到晚上12点，是低谷期。</p><p>虽然任务有明显的高峰低谷效应，但是服务器资源不是弹性的，所以就会出现服务器在低谷期比较空闲，在高峰期比较繁忙的情况，整个集群的资源配置取决于高峰期的任务消耗。所以，把一些不必要在高峰期内运行任务迁移到低谷期运行，也可以节省资源的消耗。</p><p><strong>第七，任务参数配置。</strong></p><p>任务参数配置的不合理，往往也会浪费资源。比如在Spark中，Executor 内存设置的过大；CPU设置的过多；还有Spark 没有开启动态资源分配策略，一些已经运行完Task的Executor 不能释放，持续占用资源，尤其是遇到数据倾斜的情况，资源浪费会更加明显。</p><p><strong>第八，数据未压缩。</strong></p><p>Hadoop 的HDFS 为了实现高可用，默认数据存储3副本，所以大数据的物理存储量消耗是比较大的。尤其是对于一些原始数据层和明细数据层的大表，动辄500多T，折合物理存储需要1.5P（三副本，所以实际物理存储500_3），大约需要16台物理服务器（一台服务器可分配存储按照12_8T计算），如果不启用压缩，存储资源成本会很高。</p><p>另外，在Hive或者Spark 计算过程中，中间结果也需要压缩，可以降低网络传输量，提高Shuffer (在Hive或者Spark 计算过程中，数据在不同节点之间的传输过程)性能。</p><p>你看，我为你列举了8个典型的成本陷阱，那你可能会问了，老师，我已经中招了，该怎么办呢？ 别急，接下来我们就看一看，如何进行精细化的成本管理。</p><h2 id="如何实现精细化成本管理"><a aria-hidden="true" tabindex="-1" href="/blog-backend/数据中台实战课/03.实现篇/05#如何实现精细化成本管理"><span class="icon icon-link"></span></a>如何实现精细化成本管理？</h2><p>我认为，成本治理应该遵循全局盘点、发现问题、治理优化和效果评估四个步骤。</p><p><img src="/blog-backend/static/httpsstatic001geekbangorgresourceimageb7bbb72d173eee93d56100bcc7f53da0a1bb.276bb61a.jpg" alt=""/></p><h3 id="全局资产盘点"><a aria-hidden="true" tabindex="-1" href="/blog-backend/数据中台实战课/03.实现篇/05#全局资产盘点"><span class="icon icon-link"></span></a>全局资产盘点</h3><p>精细化成本管理的第一步，就是要对数据中台中，所有的数据进行一次全面盘点，基于元数据中心提供的数据血缘，建立全链路的数据资产视图。</p><p><img src="/blog-backend/static/httpsstatic001geekbangorgresourceimagefc64fc9f418642523cc955ba91575f240064.d146a602.jpg" alt=""/></p><p>从这个图中你可以看到，全链路数据资产视图的下游末端关联到了数据应用（报表：财务分析），而上游的起点是刚进入数据中台的原始数据。数据之间通过任务进行连接。</p><p>接下来，我们要计算全链路数据资产视图中，末端数据的成本和价值（末端数据就是加工链路最下游的表，例如图中TableA，Table G）。</p><p>为什么一定要从末端开始呢？ 因为中间数据，在计算价值的时候，还要考虑下游表被使用的情况，比较难计算清楚，所以我们选择从末端数据开始。这与我们下线表的顺序也是一致的，如果数据的价值很低，成本很高，我们也是从末端数据开始下线的。</p><p><strong>那么数据成本该如何计算呢？</strong></p><p>我们要对上图中财务分析报表核算成本，这个报表上游链路中涉及到a，b，c，3个任务，A，B，C，D，E，F， 6张表，那么：</p><blockquote><p>这张报表的成本=3个任务加工消耗的计算资源成本+6张表消耗的存储资源的成本。</p></blockquote><p>另外，需要注意的是，如果一个表被多个下游应用复用，那这个表的存储资源成本以及产出任务消耗的成本，需要分摊给多个应用。</p><p><strong>那价值又该如何计算呢？</strong></p><p><img src="/blog-backend/static/httpsstatic001geekbangorgresourceimagee463e4a0117a42386ad9c8bec7a418d89563.a98b311f.jpg" alt=""/></p><p>我们来分析一下这张图。</p><p>如果末端数据是一张应用层的表，它对接的是一个数据报表，那衡量这个数据的价值，主要是看报表的使用范围和使用频率。在计算使用范围时，通常用周活来评估，同时还要考虑不同管理级别的人权重，对于老板，他一个人的权重可以相当于1000个普通员工。</p><p>之所以这样设计，是考虑到管理级别越高，做出的商业决策影响就越大，自然这个价值也就越大。使用频率一般使用单个用户每周查看报表的次数来衡量，次数越高，说明报表价值越大。</p><p>如果末端数据对接的不是一个数据报表，而是面向特定场景的数据应用（比如我之前提到过的供应链分析决策系统，它面向的人群主要是供应链部门）。衡量这类产品的价值，主要考虑目标人群的覆盖率和直接业务价值产出。什么是直接业务价值产出呢？，在供应链决策系统中，就是通过系统自动生成的采购订单占所有采购订单的比例。</p><p>除此之外，末端数据，可能还是一张集市层的表，它主要用于提供给分析师做探索式查询。这类表的价值主要看它被哪些分析师使用，使用频率如何。同样，在使用范围评估时，要对分析师按照级别进行加权。</p><h3 id="发现问题"><a aria-hidden="true" tabindex="-1" href="/blog-backend/数据中台实战课/03.实现篇/05#发现问题"><span class="icon icon-link"></span></a>发现问题</h3><p>全局盘点，为我们发现问题提供了数据支撑，而你需要重点关注下面三类问题：</p><ul><li>持续产生成本，但是已经没有使用的末端数据（“没有使用”一般指30天内没有访问）；</li><li>数据应用价值很低，成本却很高，这些数据应用上游链路上的所有相关数据；</li><li>高峰期高消耗的数据。</li></ul><p>那么为什么你要关注这三类数据呢？</p><ul><li>其实第一类就是没有使用，但一直在消耗成本的表，对应的就是我提到的陷阱1。</li><li>第二类其实就是低价值产出，高成本的数据应用，对应的是陷阱2。</li><li>第三类高成本的数据，对应的就是陷阱4～8。</li></ul><p><img src="/blog-backend/static/httpsstatic001geekbangorgresourceimage863686978c0d60e6cc050b1b9fc512221b36.42c35c22.png" alt=""/></p><p>陷阱3实际是在第6节模型设计中解决的。</p><h3 id="治理优化"><a aria-hidden="true" tabindex="-1" href="/blog-backend/数据中台实战课/03.实现篇/05#治理优化"><span class="icon icon-link"></span></a>治理优化</h3><p>针对这三类问题，我们需要制订相应的策略。</p><p>对于第一类问题，应该对表进行下线。 数据下线要谨慎，你可以参考这张数据下线的执行过程图：</p><p><img src="/blog-backend/static/httpsstatic001geekbangorgresourceimage9a3b9a782afd76ce95cab7e224afb97e123b.94ec9525.jpg" alt=""/></p><p>末端数据删除后，原先末端数据的上游数据会成为新的末端数据，同样还要按发现问题到治理优化进行重复，直到所有的末端数据都不满足下线策略为止。</p><p>对第二类问题，我们需要按照应用粒度评估应用是否还有存在的必要。对于报表，可以按照30天内没有访问的应用自动下线的策略，先对报表进行销毁，然后对报表上游的表进行下线，如果该表还被其他的应用引用，就不能下线。<strong>下线步骤可以参考前面的下线步骤。</strong></p><p>第三类问题，主要是针对高消耗的数据，又具体分为产出数据的任务高消耗和数据存储高消耗。对于产出任务高消耗，首先要考虑是不是数据倾斜。具体怎么判断呢？其实你可以通过MR或者Spark日志中，Shuffer的数据量进行判断。如果有某一个Task 数据量非常大，其他的很少，就可以判定出现了数据倾斜。</p><p><img src="/blog-backend/static/httpsstatic001geekbangorgresourceimagebb4abb6bff0893077c370c812911684ed24a.acfa1728.png" alt="" title="图 Spark task shuffer records"/></p><p><img src="/blog-backend/static/httpsstatic001geekbangorgresourceimagece62ce3feb95851ef24d662127dae42cf062.f82b3793.png" alt="" title="图 MR reduce task records"/></p><p>如果出现数据倾斜，该如何处理呢？</p><p>数据倾斜的处理方法有很多，不同的场景有一些适用的解决方案：比如在一些大表和小表关联时，Key 分布不均造成的数据倾斜，可以使用mapjoin的方式解决；另外还有一些比较通用的处理方式，例如把热点的Key 进行单独的处理，然后对剩下的Key进行处理，然后对结果进行并集。</p><p>因为它不是本文的重点，所以这里就不再详细展开，之前有一篇美团的文章，对数据倾斜有比较深入的分析，推荐给你做课下学习的<a target="_blank" rel="noopener noreferrer" href="https://tech.meituan.com/2016/05/12/spark-tuning-pro.html">资料。<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="__dumi-default-external-link-icon"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p><p>除了数据倾斜，我们还应该检查任务的配置参数。例如对于Spark 执行引擎，Executor 个数是否开的过大，executor-cores和executor-memory是否开的过多，利用率比较低。一般来说，executors-memorty 设置为4G-8G为宜，executor-cores设置为2-4个为宜（这是我们实践过利用率最高的配置选项）。</p><p>另外，你还要考虑任务是否真的有必要在高峰期执行，可以根据集群的负载情况，尽量将任务迁移到非高峰期执行，我将这个步骤称为“削峰填谷”。</p><p>上面几点是产出任务高消耗的情况，那么对于存储消耗比较大的任务，你首先要考虑是否要压缩，尤其是对于原始数据层和明细数据层，建议压缩，压缩的方式有这样几种：</p><p><img src="/blog-backend/static/httpsstatic001geekbangorgresourceimage9cfd9c17d6c8975d68ca3679a201fd05dcfd.f2b5b01d.jpg" alt=""/></p><p>整体来看，对于小文件的压缩，不考虑split，gzip比较合适；对于大文件，推荐使用lzo，支持split，在保证压缩效率的前提下，有着相对稳定的压缩比。</p><p>除此之外，还需要考虑生命周期是否设置：</p><ul><li>对于ODS原始数据层和DWD 明细数据层，比较适合用永久保留的策略；</li><li>对于一些商品、用户维表，可以考虑3年或者5年的保留策略。</li></ul><p>整体上，底层表都是长期保留的。所以你的关注重点应该是汇总层以上的表（包括汇总层），一般可以根据数据的重要性，制订7天，1个月的保留策略。</p><h3 id="治理效果评估"><a aria-hidden="true" tabindex="-1" href="/blog-backend/数据中台实战课/03.实现篇/05#治理效果评估"><span class="icon icon-link"></span></a>治理效果评估</h3><p>现在，通过我介绍的这几个方法，你已经能够节省大量的资源消耗，那如何量化我们的治理成果呢？</p><p>五个字：省了多少钱。不过，如果直接拿服务器的数量来衡量，其实并不能真实地反应治理效果，因为还要考虑业务增长的原因。业务不是停止不动的，所以你可以围绕任务和数据的成本考虑这样几点：</p><ul><li>下线了多少任务和数据；</li><li>这些任务每日消耗了多少资源；</li><li>数据占用了多少存储空间。</li></ul><p>拿这些资源来计算成本，这样就能够算出来省了多少钱。我还是拿本节课开始的例子来看，任务A 运行时长 3个小时，在运行过程中，共消耗5384503 cpu*s，37007892 GB *s, 假设我们1个CU （1 cpu， 4g memeory）一年是1300元成本，折合每天为3.5元（计算公式为1300/365）。</p><p>**这里需要特别强调，**不论是优化或者下线任务，我们只统计高峰时间段内，因为优化低峰时间，并不能实际节省资源。</p><p>高峰时间段为8个小时，那折合每秒的费用为0.00012153, 那该任务的费用为max<!-- -->{<!-- -->5384503*0.00012153, 37007892/4 * 0.00012153<!-- -->}<!-- --> = max<!-- -->{<!-- -->654, 1124<!-- -->}<!-- --> = 1124 。那下线这个任务后，就节省1124元，再加上表 A占用的存储空间大小乘以每GB的成本，就可以得出数据表A下线节省的费用。</p><h2 id="成本治理中心"><a aria-hidden="true" tabindex="-1" href="/blog-backend/数据中台实战课/03.实现篇/05#成本治理中心"><span class="icon icon-link"></span></a>成本治理中心</h2><p>成本治理不是一劳永逸的工作，需要持之以恒，不断发现问题，然后治理优化，建立长久运行机制的前提是必须降低成本治理的门槛，接下来，看一下网易的一个成本治理的平台，EasyCost。<br/><img src="/blog-backend/static/httpsstatic001geekbangorgresourceimage948d94acdfab6f168b955d16109748abed8d.a106796e.png" alt=""/></p><p>系统提供了数据诊断的功能，可以按照访问时间、访问频率、关联的应用，设置下线策略，支持一键灰度下线，大幅提高了管理的效率。</p><p><img src="/blog-backend/static/httpsstatic001geekbangorgresourceimage04f4047cef40dba74b20b9d97f31d92216f4.9fb14bbf.png" alt=""/></p><p>通过介绍EasyCost，我想告诉你的是，今天的内容，其实可以通过系统化的方式沉淀到产品中，然后通过产品提高管理的效率，从而实现治理机制的长久落地。</p><h2 id="课堂总结"><a aria-hidden="true" tabindex="-1" href="/blog-backend/数据中台实战课/03.实现篇/05#课堂总结"><span class="icon icon-link"></span></a>课堂总结</h2><p>总的来说，通过数据中台，一方面你可以获得大数据作为资产中心带来的红利，另一方面，你也有可能陷入成本的深渊，为野蛮增长的大数据费用买单。</p><p>今天这节课，我从常见的8个成本陷阱入手，带你分析了可能造成成本浪费的原因，然后介绍了精细化成本管理的方法，在最后，我想再强调几个你可能忽略的点：</p><ul><li><p>无用数据的下线应该从全链路数据资产视图的末端入手，然后抽丝剥茧，一层一层，向数据加工链路的上游推进。</p></li><li><p>应用层表的价值应该以数据应用的价值来衡量，对于低价值产出的应用，应该以应用为粒度进行下线。</p></li><li><p>对高消耗任务的优化只要关注集群高峰期的任务，项目的整体资源消耗只取决于高峰期的任务消耗，当然，如果你使用的是公有云的资源，可以高峰和低谷实施差异化的成本结算，那低谷期的也是要关注的。</p></li></ul><p><img src="/blog-backend/static/httpsstatic001geekbangorgresourceimagec2b7c233339ec939674b3e1517d69d7b9bb7.f496171b.jpg" alt=""/></p><h2 id="思考时间"><a aria-hidden="true" tabindex="-1" href="/blog-backend/数据中台实战课/03.实现篇/05#思考时间"><span class="icon icon-link"></span></a>思考时间</h2><p>在数据中台的集市层，会存在一些大的宽表，这些宽表可能存在几百个字段，上游可能有数十个表，如果要计算这个表的成本会非常高。在这个表中，字段的访问频率是不相同，有的字段频率很高，有的字段频率很低，如果要对这张宽表做优化，你觉得如何来做呢?</p><p>最后感谢你的阅读，如果这节课让你有所收获，也欢迎你分享给更多的朋友。</p></div><div class="__dumi-default-layout-footer-meta"><a target="_blank" rel="noopener noreferrer" href="https://github.com/GGwujun/blog/edit/master/ssrc/数据中台实战课/03.实现篇/05.md">在 GitHub 上编辑此页<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="__dumi-default-external-link-icon"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a><span data-updated-text="最后更新时间：">2023/9/27 11:15:40</span></div></div></div></div>
	<script>
  window.g_useSSR = true;
  window.g_initialProps = {};
	</script>

    <script>
      (function () {
        if (!location.port) {
          (function (i, s, o, g, r, a, m) {
            i["GoogleAnalyticsObject"] = r;
            (i[r] =
              i[r] ||
              function () {
                (i[r].q = i[r].q || []).push(arguments);
              }),
              (i[r].l = 1 * new Date());
            (a = s.createElement(o)), (m = s.getElementsByTagName(o)[0]);
            a.async = 1;
            a.src = g;
            m.parentNode.insertBefore(a, m);
          })(
            window,
            document,
            "script",
            "//www.google-analytics.com/analytics.js",
            "ga"
          );
          ga("create", "UA-149864185-1", "auto");
          ga("send", "pageview");
        }
      })();
    </script>
    <script src="/blog-backend/umi.e14e5a14.js"></script>
  </body>
</html>
