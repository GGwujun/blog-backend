<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1, maximum-scale=1, minimum-scale=1, user-scalable=no"
    />
    <link rel="shortcut icon" type="image/x-icon" href="/logo.png" />
    <link rel="stylesheet" href="/blog-backend/umi.3ec1f225.css" />
    <script>
      window.routerBase = "/blog-backend";
    </script>
    <script>
      //! umi version: 3.5.41
    </script>
    <script>
      !(function () {
        var e =
            navigator.cookieEnabled && void 0 !== window.localStorage
              ? localStorage.getItem("dumi:prefers-color")
              : "auto",
          o = window.matchMedia("(prefers-color-scheme: dark)").matches,
          t = ["light", "dark", "auto"];
        document.documentElement.setAttribute(
          "data-prefers-color",
          e === t[2] ? (o ? t[1] : t[0]) : t.indexOf(e) > -1 ? e : t[0]
        );
      })();
    </script>
    <title>03丨Java虚拟机原理：JVM为什么被称为机器（machine）？ - 大师兄</title>
  </head>
  <body>
    <div id="root"><div class="__dumi-default-layout" data-route="/后端技术面试38讲/02.软件的基础原理/03" data-show-sidemenu="true" data-show-slugs="true" data-site-mode="true" data-gapless="false"><div class="__dumi-default-navbar" data-mode="site"><button class="__dumi-default-navbar-toggle"></button><a class="__dumi-default-navbar-logo" style="background-image:url(&#x27;/logo.png&#x27;)" href="/blog-backend/">大师兄</a><nav><div class="__dumi-default-search"><input type="search" class="__dumi-default-search-input" value=""/><ul></ul></div><span>后端开发<ul><li><a href="/blog-backend/go语言核心36讲">go语言核心36讲</a></li><li><a href="/blog-backend/go并发编程实战">go并发编程实战</a></li><li><a href="/blog-backend/go语言项目开发实战">go语言项目开发实战</a></li><li><a href="/blog-backend/kafka核心技术与实战">kafka核心技术与实战</a></li><li><a href="/blog-backend/kafka核心源码解读">kafka核心源码解读</a></li><li><a href="/blog-backend/零基础学python">零基础学python</a></li><li><a href="/blog-backend/python核心技术与实战">python核心技术与实战</a></li><li><a href="/blog-backend/redis核心技术与实战">redis核心技术与实战</a></li><li><a href="/blog-backend/redis源码剖析与实战">redis源码剖析与实战</a></li><li><a href="/blog-backend/陈天rust编程第一课">陈天rust编程第一课</a></li><li><a href="/blog-backend/tonybaigo语言第一课">tonybaigo语言第一课</a></li><li><a href="/blog-backend/后端存储实战课">后端存储实战课</a></li><li><a aria-current="page" class="active" href="/blog-backend/后端技术面试38讲">后端技术面试38讲</a></li><li><a href="/blog-backend/深入c语言和程序运行原理">深入c语言和程序运行原理</a></li><li><a href="/blog-backend/现代c编程实战">现代c编程实战</a></li><li><a href="/blog-backend/罗剑锋的c实战笔记">罗剑锋的c实战笔记</a></li><li><a href="/blog-backend/零基础入门spark">零基础入门spark</a></li></ul></span><span>架构师<ul><li><a href="/blog-backend/mysql实战45讲">mysql实战45讲</a></li><li><a href="/blog-backend/数据中台实战课">数据中台实战课</a></li></ul></span><div class="__dumi-default-navbar-tool"><div class="__dumi-default-dark"><div class="__dumi-default-dark-switch "></div></div></div></nav></div><div class="__dumi-default-menu" data-mode="site"><div class="__dumi-default-menu-inner"><div class="__dumi-default-menu-header"><a class="__dumi-default-menu-logo" style="background-image:url(&#x27;/logo.png&#x27;)" href="/blog-backend/"></a><h1>大师兄</h1><p></p></div><div class="__dumi-default-menu-mobile-area"><ul class="__dumi-default-menu-nav-list"><li>后端开发<ul><li><a href="/blog-backend/go语言核心36讲">go语言核心36讲</a></li><li><a href="/blog-backend/go并发编程实战">go并发编程实战</a></li><li><a href="/blog-backend/go语言项目开发实战">go语言项目开发实战</a></li><li><a href="/blog-backend/kafka核心技术与实战">kafka核心技术与实战</a></li><li><a href="/blog-backend/kafka核心源码解读">kafka核心源码解读</a></li><li><a href="/blog-backend/零基础学python">零基础学python</a></li><li><a href="/blog-backend/python核心技术与实战">python核心技术与实战</a></li><li><a href="/blog-backend/redis核心技术与实战">redis核心技术与实战</a></li><li><a href="/blog-backend/redis源码剖析与实战">redis源码剖析与实战</a></li><li><a href="/blog-backend/陈天rust编程第一课">陈天rust编程第一课</a></li><li><a href="/blog-backend/tonybaigo语言第一课">tonybaigo语言第一课</a></li><li><a href="/blog-backend/后端存储实战课">后端存储实战课</a></li><li><a aria-current="page" class="active" href="/blog-backend/后端技术面试38讲">后端技术面试38讲</a></li><li><a href="/blog-backend/深入c语言和程序运行原理">深入c语言和程序运行原理</a></li><li><a href="/blog-backend/现代c编程实战">现代c编程实战</a></li><li><a href="/blog-backend/罗剑锋的c实战笔记">罗剑锋的c实战笔记</a></li><li><a href="/blog-backend/零基础入门spark">零基础入门spark</a></li></ul></li><li>架构师<ul><li><a href="/blog-backend/mysql实战45讲">mysql实战45讲</a></li><li><a href="/blog-backend/数据中台实战课">数据中台实战课</a></li></ul></li></ul><div class="__dumi-default-dark"><div class="__dumi-default-dark-switch "><button title="Dark theme" class="__dumi-default-dark-moon "><svg viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="3854" width="22" height="22"><path d="M991.816611 674.909091a69.166545 69.166545 0 0 0-51.665455-23.272727 70.795636 70.795636 0 0 0-27.438545 5.585454A415.674182 415.674182 0 0 1 754.993338 698.181818c-209.594182 0-393.472-184.785455-393.472-395.636363 0-52.363636 38.539636-119.621818 69.515637-173.614546 4.887273-8.610909 9.634909-16.756364 14.103272-24.901818A69.818182 69.818182 0 0 0 384.631156 0a70.842182 70.842182 0 0 0-27.438545 5.585455C161.678429 90.298182 14.362065 307.898182 14.362065 512c0 282.298182 238.824727 512 532.38691 512a522.286545 522.286545 0 0 0 453.957818-268.334545A69.818182 69.818182 0 0 0 991.816611 674.909091zM546.679156 954.181818c-248.785455 0-462.941091-192-462.941091-442.181818 0-186.647273 140.637091-372.829091 300.939637-442.181818-36.817455 65.629091-92.578909 151.970909-92.578909 232.727273 0 250.181818 214.109091 465.454545 462.917818 465.454545a488.331636 488.331636 0 0 0 185.181091-46.545455 453.003636 453.003636 0 0 1-393.565091 232.727273z m103.656728-669.323636l-14.266182 83.781818a34.909091 34.909091 0 0 0 50.362182 36.770909l74.775272-39.563636 74.752 39.563636a36.142545 36.142545 0 0 0 16.174546 3.956364 34.909091 34.909091 0 0 0 34.210909-40.727273l-14.289455-83.781818 60.509091-59.345455a35.025455 35.025455 0 0 0-19.223272-59.578182l-83.61891-12.101818-37.376-76.101818a34.56 34.56 0 0 0-62.254545 0l-37.376 76.101818-83.618909 12.101818a34.909091 34.909091 0 0 0-19.246546 59.578182z m70.423272-64.698182a34.280727 34.280727 0 0 0 26.135273-19.083636l14.312727-29.090909 14.336 29.090909a34.257455 34.257455 0 0 0 26.135273 19.083636l32.046546 4.887273-23.272728 22.574545a35.234909 35.234909 0 0 0-10.007272 30.952727l5.46909 32.116364-28.625454-15.127273a34.490182 34.490182 0 0 0-32.302546 0l-28.695272 15.127273 5.469091-32.116364a35.141818 35.141818 0 0 0-9.984-30.952727l-23.272728-22.574545z" p-id="3855"></path></svg></button><button title="Light theme" class="__dumi-default-dark-sun "><svg viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="4026" width="22" height="22"><path d="M915.2 476.16h-43.968c-24.704 0-44.736 16-44.736 35.84s20.032 35.904 44.736 35.904H915.2c24.768 0 44.8-16.064 44.8-35.904s-20.032-35.84-44.8-35.84zM512 265.6c-136.704 0-246.464 109.824-246.464 246.4 0 136.704 109.76 246.464 246.464 246.464S758.4 648.704 758.4 512c0-136.576-109.696-246.4-246.4-246.4z m0 425.6c-99.008 0-179.2-80.128-179.2-179.2 0-98.944 80.192-179.2 179.2-179.2S691.2 413.056 691.2 512c0 99.072-80.192 179.2-179.2 179.2zM197.44 512c0-19.84-19.136-35.84-43.904-35.84H108.8c-24.768 0-44.8 16-44.8 35.84s20.032 35.904 44.8 35.904h44.736c24.768 0 43.904-16.064 43.904-35.904zM512 198.464c19.776 0 35.84-20.032 35.84-44.8v-44.8C547.84 84.032 531.84 64 512 64s-35.904 20.032-35.904 44.8v44.8c0 24.768 16.128 44.864 35.904 44.864z m0 627.136c-19.776 0-35.904 20.032-35.904 44.8v44.736C476.096 940.032 492.16 960 512 960s35.84-20.032 35.84-44.8v-44.736c0-24.768-16.064-44.864-35.84-44.864z m329.92-592.832c17.472-17.536 20.288-43.072 6.4-57.024-14.016-14.016-39.488-11.2-57.024 6.336-4.736 4.864-26.496 26.496-31.36 31.36-17.472 17.472-20.288 43.008-6.336 57.024 13.952 14.016 39.488 11.2 57.024-6.336 4.8-4.864 26.496-26.56 31.296-31.36zM213.376 759.936c-4.864 4.8-26.56 26.624-31.36 31.36-17.472 17.472-20.288 42.944-6.4 56.96 14.016 13.952 39.552 11.2 57.024-6.336 4.8-4.736 26.56-26.496 31.36-31.36 17.472-17.472 20.288-43.008 6.336-56.96-14.016-13.952-39.552-11.072-56.96 6.336z m19.328-577.92c-17.536-17.536-43.008-20.352-57.024-6.336-14.08 14.016-11.136 39.488 6.336 57.024 4.864 4.864 26.496 26.56 31.36 31.424 17.536 17.408 43.008 20.288 56.96 6.336 14.016-14.016 11.264-39.488-6.336-57.024-4.736-4.864-26.496-26.56-31.296-31.424z m527.168 628.608c4.864 4.864 26.624 26.624 31.36 31.424 17.536 17.408 43.072 20.224 57.088 6.336 13.952-14.016 11.072-39.552-6.4-57.024-4.864-4.8-26.56-26.496-31.36-31.36-17.472-17.408-43.072-20.288-57.024-6.336-13.952 14.016-11.008 39.488 6.336 56.96z" p-id="4027"></path></svg></button><button title="Default to system" class="__dumi-default-dark-auto "><svg viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="11002" width="22" height="22"><path d="M127.658667 492.885333c0-51.882667 10.24-101.717333 30.378666-149.162666s47.786667-88.064 81.92-122.538667 75.093333-61.781333 122.538667-81.92 96.938667-30.378667 149.162667-30.378667 101.717333 10.24 149.162666 30.378667 88.405333 47.786667 122.88 81.92 61.781333 75.093333 81.92 122.538667 30.378667 96.938667 30.378667 149.162666-10.24 101.717333-30.378667 149.162667-47.786667 88.405333-81.92 122.88-75.093333 61.781333-122.88 81.92-97.28 30.378667-149.162666 30.378667-101.717333-10.24-149.162667-30.378667-88.064-47.786667-122.538667-81.92-61.781333-75.093333-81.92-122.88-30.378667-96.938667-30.378666-149.162667z m329.045333 0c0 130.048 13.994667 244.394667 41.984 343.381334h12.970667c46.762667 0 91.136-9.216 133.461333-27.306667s78.848-42.666667 109.568-73.386667 54.954667-67.242667 73.386667-109.568 27.306667-86.698667 27.306666-133.461333c0-46.421333-9.216-90.794667-27.306666-133.12s-42.666667-78.848-73.386667-109.568-67.242667-54.954667-109.568-73.386667-86.698667-27.306667-133.461333-27.306666h-11.605334c-28.672 123.562667-43.349333 237.909333-43.349333 343.722666z" p-id="11003"></path></svg></button></div></div></div><ul class="__dumi-default-menu-list"><li><a href="/blog-backend/后端技术面试38讲">后端技术面试38讲</a></li><li><a href="/blog-backend/后端技术面试38讲/01.开篇词">01.开篇词</a><ul><li><a href="/blog-backend/后端技术面试38讲/01.开篇词/01"><span>开篇词 | 掌握软件开发技术的第一性原理</span></a></li></ul></li><li><a aria-current="page" class="active" href="/blog-backend/后端技术面试38讲/02.软件的基础原理">02.软件的基础原理</a><ul><li><a href="/blog-backend/后端技术面试38讲/02.软件的基础原理/01"><span>01丨程序运行原理：程序是如何运行又是如何崩溃的？</span></a></li><li><a href="/blog-backend/后端技术面试38讲/02.软件的基础原理/02"><span>02丨数据结构原理：Hash表的时间复杂度为什么是O(1)？</span></a></li><li><a aria-current="page" class="active" href="/blog-backend/后端技术面试38讲/02.软件的基础原理/03"><span>03丨Java虚拟机原理：JVM为什么被称为机器（machine）？</span></a></li><li><a href="/blog-backend/后端技术面试38讲/02.软件的基础原理/04"><span>04丨网络编程原理：一个字符的互联网之旅</span></a></li><li><a href="/blog-backend/后端技术面试38讲/02.软件的基础原理/05"><span>05丨文件系统原理：如何用1分钟遍历一个100TB的文件？</span></a></li><li><a href="/blog-backend/后端技术面试38讲/02.软件的基础原理/06"><span>06丨数据库原理：为什么PrepareStatement性能更好更安全？</span></a></li><li><a href="/blog-backend/后端技术面试38讲/02.软件的基础原理/07"><span>07丨编程语言原理：面向对象编程是编程的终极形态吗？</span></a></li><li><a href="/blog-backend/后端技术面试38讲/02.软件的基础原理/08"><span>答疑丨Java Web程序的运行时环境到底是怎样的？</span></a></li></ul></li><li><a href="/blog-backend/后端技术面试38讲/03.软件的设计原理">03.软件的设计原理</a><ul><li><a href="/blog-backend/后端技术面试38讲/03.软件的设计原理/01"><span>08丨软件设计的方法论：软件为什么要建模？</span></a></li><li><a href="/blog-backend/后端技术面试38讲/03.软件的设计原理/02"><span>09丨软件设计实践：如何使用UML完成一个设计文档？</span></a></li><li><a href="/blog-backend/后端技术面试38讲/03.软件的设计原理/03"><span>10 | 软件设计的目的：糟糕的程序员比优秀的程序员差在哪里？</span></a></li><li><a href="/blog-backend/后端技术面试38讲/03.软件的设计原理/04"><span>11丨软件设计的开闭原则：如何不修改代码却能实现需求变更？</span></a></li><li><a href="/blog-backend/后端技术面试38讲/03.软件的设计原理/05"><span>12 | 软件设计的依赖倒置原则：如何不依赖代码却可以复用它的功能？</span></a></li><li><a href="/blog-backend/后端技术面试38讲/03.软件的设计原理/06"><span>13丨软件设计的里氏替换原则：正方形可以继承长方形吗？</span></a></li><li><a href="/blog-backend/后端技术面试38讲/03.软件的设计原理/07"><span>14 | 软件设计的单一职责原则：为什么说一个类文件打开最好不要超过一屏？</span></a></li><li><a href="/blog-backend/后端技术面试38讲/03.软件的设计原理/08"><span>15丨软件设计的接口隔离原则：如何对类的调用者隐藏类的公有方法？</span></a></li><li><a href="/blog-backend/后端技术面试38讲/03.软件的设计原理/09"><span>16 | 设计模式基础：不会灵活应用设计模式，你就没有掌握面向对象编程</span></a></li><li><a href="/blog-backend/后端技术面试38讲/03.软件的设计原理/10"><span>17 | 设计模式应用：编程框架中的设计模式</span></a></li><li><a href="/blog-backend/后端技术面试38讲/03.软件的设计原理/11"><span>18 | 反应式编程框架设计：如何使程序调用不阻塞等待，立即响应？</span></a></li><li><a href="/blog-backend/后端技术面试38讲/03.软件的设计原理/12"><span>19 | 组件设计原则：组件的边界在哪里？</span></a></li><li><a href="/blog-backend/后端技术面试38讲/03.软件的设计原理/13"><span>20 | 领域驱动设计：35岁的程序员应该写什么样的代码？</span></a></li><li><a href="/blog-backend/后端技术面试38讲/03.软件的设计原理/14"><span>答疑丨对于设计模式而言，场景到底有多重要？</span></a></li></ul></li><li><a href="/blog-backend/后端技术面试38讲/04.架构的核心原理">04.架构的核心原理</a><ul><li><a href="/blog-backend/后端技术面试38讲/04.架构的核心原理/01"><span>21丨分布式架构：如何应对高并发的用户请求</span></a></li><li><a href="/blog-backend/后端技术面试38讲/04.架构的核心原理/02"><span>22 | 缓存架构：如何减少不必要的计算？</span></a></li><li><a href="/blog-backend/后端技术面试38讲/04.架构的核心原理/03"><span>23 | 异步架构：如何避免互相依赖的系统间耦合？</span></a></li><li><a href="/blog-backend/后端技术面试38讲/04.架构的核心原理/04"><span>24 | 负载均衡架构：如何用10行代码实现一个负载均衡服务？</span></a></li><li><a href="/blog-backend/后端技术面试38讲/04.架构的核心原理/05"><span>25 | 数据存储架构：如何改善系统的数据存储能力？</span></a></li><li><a href="/blog-backend/后端技术面试38讲/04.架构的核心原理/06"><span>26 | 搜索引擎架构：如何瞬间完成海量数据检索？</span></a></li><li><a href="/blog-backend/后端技术面试38讲/04.架构的核心原理/07"><span>27 | 微服务架构：微服务究竟是灵丹还是毒药？</span></a></li><li><a href="/blog-backend/后端技术面试38讲/04.架构的核心原理/08"><span>28 | 高性能架构：除了代码，你还可以在哪些地方优化性能？</span></a></li><li><a href="/blog-backend/后端技术面试38讲/04.架构的核心原理/09"><span>29 | 高可用架构：我们为什么感觉不到淘宝应用升级时的停机？</span></a></li><li><a href="/blog-backend/后端技术面试38讲/04.架构的核心原理/10"><span>30 | 安全性架构：为什么说用户密码泄漏是程序员的锅？</span></a></li><li><a href="/blog-backend/后端技术面试38讲/04.架构的核心原理/11"><span>31 | 大数据架构：大数据技术架构的思想和原理是什么？</span></a></li><li><a href="/blog-backend/后端技术面试38讲/04.架构的核心原理/12"><span>32 | AI与物联网架构：从智能引擎到物联网平台</span></a></li><li><a href="/blog-backend/后端技术面试38讲/04.架构的核心原理/13"><span>33 | 区块链技术架构：区块链到底能做什么？</span></a></li><li><a href="/blog-backend/后端技术面试38讲/04.架构的核心原理/14"><span>答疑丨互联网需要解决的技术问题是什么？</span></a></li></ul></li><li><a href="/blog-backend/后端技术面试38讲/05.技术人的思维修炼">05.技术人的思维修炼</a><ul><li><a href="/blog-backend/后端技术面试38讲/05.技术人的思维修炼/01"><span>34 | 技术修炼之道：同样工作十几年，为什么有的人成为大厂架构师，有的人失业？</span></a></li><li><a href="/blog-backend/后端技术面试38讲/05.技术人的思维修炼/02"><span>35 | 技术进阶之道：你和这个星球最顶级的程序员差几个等级？</span></a></li><li><a href="/blog-backend/后端技术面试38讲/05.技术人的思维修炼/03"><span>36丨技术落地之道：你真的知道自己要解决的问题是什么吗？</span></a></li><li><a href="/blog-backend/后端技术面试38讲/05.技术人的思维修炼/04"><span>37丨技术沟通之道：如何解决问题？</span></a></li><li><a href="/blog-backend/后端技术面试38讲/05.技术人的思维修炼/05"><span>38丨技术管理之道：你真的要转管理吗？</span></a></li><li><a href="/blog-backend/后端技术面试38讲/05.技术人的思维修炼/06"><span>答疑丨工作中的交往和沟通，都有哪些小技巧呢？</span></a></li></ul></li><li><a href="/blog-backend/后端技术面试38讲/06.不定期加餐">06.不定期加餐</a><ul><li><a href="/blog-backend/后端技术面试38讲/06.不定期加餐/01"><span>加餐 | 软件设计文档示例模板</span></a></li></ul></li><li><a href="/blog-backend/后端技术面试38讲/07.结束语">07.结束语</a><ul><li><a href="/blog-backend/后端技术面试38讲/07.结束语/01"><span>结束语丨期待未来的你，成为优秀的软件架构师</span></a></li></ul></li><li><a href="/blog-backend/后端技术面试38讲/08.期末考试">08.期末考试</a><ul><li><a href="/blog-backend/后端技术面试38讲/08.期末考试/01"><span>期末测试丨快来测测你对专栏内容掌握到何种程度了</span></a></li></ul></li><li><a href="/blog-backend/后端技术面试38讲/summary">后端技术面试38讲</a></li></ul></div></div><ul role="slug-list" class="__dumi-default-layout-toc"><li title="JVM的组成构造" data-depth="2"><a href="/blog-backend/后端技术面试38讲/02.软件的基础原理/03#jvm的组成构造"><span>JVM的组成构造</span></a></li><li title="JVM的垃圾回收" data-depth="2"><a href="/blog-backend/后端技术面试38讲/02.软件的基础原理/03#jvm的垃圾回收"><span>JVM的垃圾回收</span></a></li><li title="小结" data-depth="2"><a href="/blog-backend/后端技术面试38讲/02.软件的基础原理/03#小结"><span>小结</span></a></li><li title="思考题" data-depth="2"><a href="/blog-backend/后端技术面试38讲/02.软件的基础原理/03#思考题"><span>思考题</span></a></li></ul><div class="__dumi-default-layout-content"><div class="markdown"><h1 id="03丨java虚拟机原理jvm为什么被称为机器machine"><a aria-hidden="true" tabindex="-1" href="/blog-backend/后端技术面试38讲/02.软件的基础原理/03#03丨java虚拟机原理jvm为什么被称为机器machine"><span class="icon icon-link"></span></a>03丨Java虚拟机原理：JVM为什么被称为机器（machine）？</h1><p>人们常说，Java是一种跨平台的语言，这意味着Java开发出来的程序经过编译后，可以在Linux上运行，也可以在Windows上运行；可以在PC、服务器上运行，也可以在手机上运行；可以在X86的CPU上运行，也可以在ARM的CPU上运行。</p><p>因为不同操作系统，特别是不同CPU架构，是不可能执行相同的指令的。而Java之所以有这种神奇的特性，就是因为Java编译的字节码文件不是直接在底层的系统平台上运行的，而是在Java虚拟机JVM上运行，JVM屏蔽了底层系统的不同，为Java字节码文件构造了一个统一的运行环境。JVM本质上也是一个应用程序，启动以后加载执行Java字节码文件。JVM的全称是Java Virtual Machine，你有没有想过，这样一个程序为什么被称为机器（Machine）呢？</p><p>其实，如果回答了这个问题，也就了解了JVM的底层构造了。这样在进行Java开发的时候，如果遇到各种问题，都可以思考一下在JVM层面是如何的？然后进一步查找资料、分析问题，直至真正地解决问题。</p><h2 id="jvm的组成构造"><a aria-hidden="true" tabindex="-1" href="/blog-backend/后端技术面试38讲/02.软件的基础原理/03#jvm的组成构造"><span class="icon icon-link"></span></a>JVM的组成构造</h2><p>要想知道这个问题的答案，我们首先需要了解JVM的构造。JVM主要由类加载器、运行时数据区、执行引擎三个部分组成。</p><p><img src="/blog-backend/static/httpsstatic001geekbangorgresourceimage620a62faabeecafe565cbd806022b2aa9c0a.952ee817.jpg" alt=""/><br/>运行时数据区主要包括方法区、堆、Java栈、程序计数寄存器。</p><p>方法区主要存放从磁盘加载进来的类字节码，而在程序运行过程中创建的类实例则存放在堆里。程序运行的时候，实际上是以线程为单位运行的，当JVM进入启动类的main方法的时候，就会为应用程序创建一个主线程，main方法里的代码就会被这个主线程执行，每个线程有自己的Java栈，栈里存放着方法运行期的局部变量。而当前线程执行到哪一行字节码指令，这个信息则被存放在程序计数寄存器。</p><p>一个典型的Java程序运行过程是下面这样的。</p><p>通过Java命令启动JVM，JVM的类加载器根据Java命令的参数到指定的路径加载.class类文件，类文件被加载到内存后，存放在专门的方法区。然后JVM创建一个主线程执行这个类文件的main方法，main方法的输入参数和方法内定义的变量被压入Java栈。如果在方法内创建了一个对象实例，这个对象实例信息将会被存放到堆里，而对象实例的引用，也就是对象实例在堆中的地址信息则会被记录在栈里。堆中记录的对象实例信息主要是成员变量信息，因为类方法内的可执行代码存放在方法区，而方法内的局部变量存放在线程的栈里。</p><p>程序计数寄存器一开始存放的是main方法的第一行代码位置，JVM的执行引擎根据这个位置去方法区的对应位置加载这行代码指令，将其解释为自身所在平台的CPU指令后交给CPU执行。如果在main方法里调用了其他方法，那么在进入其他方法的时候，会在Java栈中为这个方法创建一个新的栈帧，当线程在这个方法内执行的时候，方法内的局部变量都存放在这个栈帧里。当这个方法执行完毕退出的时候，就把这个栈帧从Java栈中出栈，这样当前栈帧，也就是堆栈的栈顶就又回到了main方法的栈帧，使用这个栈帧里的变量，继续执行main方法。这样，即使main方法和f方法都定义相同的变量，JVM也不会弄错。这部分内容我们在第一篇已经讨论过，JVM作为一个machine，和操作系统的处理线程栈的的方法是一样的。</p><p><img src="/blog-backend/static/httpsstatic001geekbangorgresourceimagea3d9a3de9184bfbd97546c291067d3106cd9.bb8dc07a.png" alt=""/><br/>Java的线程安全常常让人困惑，你可以试着从Java栈的角度去理解，所有在方法内定义的基本类型变量，都会被每个运行这个方法的线程放入自己的栈中，线程的栈彼此隔离，所以这些变量一定是线程安全的。如果在方法里创建了一个对象实例，这个对象实例如果没有被方法返回或者放入某些外部的对象容器中的话，也就是说这个对象的引用没有离开这个方法，虽然这个对象被放置在堆中，但是这个对象不会被其他线程访问到，也是线程安全的。</p><p>相反，像Servlet这样的类，在Web容器中创建以后，会被传递给每个访问Web应用的用户线程执行，这个类就不是线程安全的。但这并不意味着一定会引发线程安全问题，如果Servlet类里没有成员变量，即使多线程同时执行这个Servlet实例的方法，也不会造成成员变量冲突。这种对象被称作无状态对象，也就是说对象不记录状态，执行这个对象的任何方法都不会改变对象的状态，也就不会有线程安全问题了。事实上，Web开发实践中，常见的Service类、DAO类，都被设计成无状态对象，所以虽然我们开发的Web应用都是多线程的应用，因为Web容器一定会创建多线程来执行我们的代码，但是我们开发中却可以很少考虑线程安全的问题。</p><p>我们再回过头看JVM，它封装了一组自定义的字节码指令集，有自己的程序计数器和执行引擎，像CPU一样，可以执行运算指令。它还像操作系统一样有自己的程序装载与运行机制，内存管理机制，线程及栈管理机制，看起来就像是一台完整的计算机，这就是JVM被称作machine（机器）的原因。</p><h2 id="jvm的垃圾回收"><a aria-hidden="true" tabindex="-1" href="/blog-backend/后端技术面试38讲/02.软件的基础原理/03#jvm的垃圾回收"><span class="icon icon-link"></span></a>JVM的垃圾回收</h2><p>事实上，JVM比操作系统更进一步，它不但可以管理内存，还可以对内存进行自动垃圾回收。所谓自动垃圾回收就是将JVM堆中的已经不再被使用的对象清理掉，释放宝贵的内存资源。那么要想进行垃圾回收，首先一个问题就是如何知道哪些对象是不再被使用的，可以清理的呢？</p><p>JVM通过一种可达性分析算法进行垃圾对象的识别，具体过程是：从线程栈帧中的局部变量，或者是方法区的静态变量出发，将这些变量引用的对象进行标记，然后看这些被标记的对象是否引用了其他对象，继续进行标记，所有被标记过的对象都是被使用的对象，而那些没有被标记的对象就是可回收的垃圾对象了。所以你可以看出来，可达性分析算法其实是一个引用标记算法。</p><p>进行完标记以后，JVM就会对垃圾对象占用的内存进行回收，回收主要有三种方法。</p><p><strong>第一种方式是清理</strong>：将垃圾对象占据的内存清理掉，其实JVM并不会真的将这些垃圾内存进行清理，而是将这些垃圾对象占用的内存空间标记为空闲，记录在一个空闲列表里，当应用程序需要创建新对象的时候，就从空闲列表中找一段空闲内存分配给这个新对象。</p><p>但这样做有一个很明显的缺陷，由于垃圾对象是散落在内存空间各处的，所以标记出来的空闲空间也是不连续的，当应用程序创建一个数组需要申请一段连续的大内存空间时，即使堆空间中有足够的空闲空间，也无法为应用程序分配内存。</p><p><strong>第二种方式是压缩</strong>：从堆空间的头部开始，将存活的对象拷贝放在一段连续的内存空间中，那么其余的空间就是连续的空闲空间。</p><p><strong>第三种方法是复制</strong>：将堆空间分成两部分，只在其中一部分创建对象，当这个部分空间用完的时候，将标记过的可用对象复制到另一个空间中。JVM将这两个空间分别命名为from区域和to区域。当对象从from区域复制到to区域后，两个区域交换名称引用，继续在from区域创建对象，直到from区域满。</p><p>下面这系列图可以让你直观地了解JVM三种不同的垃圾回收机制。</p><p>回收前：</p><p><img src="/blog-backend/static/httpsstatic001geekbangorgresourceimage91f791e9bd4f5370fc22ec90ea7e093f3bf7.88d4c895.png" alt=""/><br/>清理：</p><p><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAABawAAAC0CAMAAABPPZteAAAAIGNIUk0AAHomAACAhAAA+gAAAIDoAAB1MAAA6mAAADqYAAAXcJy6UTwAAAJYUExURf///0DH9IDa+B+64T/A0z/G83/Z937Mtvz9/unw9Pv8/ebu826auFeKrYGnwa7H11CFqXujvqnD1fT3+fj6/KK+0WSTsyprl4GowcDT4EuCpypqlh9jkdDf6GyZtyNlk+Lr8T14oFWIq1uNruHq8PH1+DZznP3+/tvm7SBkkezy9lmLrf7+/+/090F7omWUtMbX42KRsp680N7o73GcuUiApWqXtqvE1oisxLzR3nihvcfY402Dp6/H2Chpld/p7/P2+c3c5i9ume3z9lWJrFSIq3Wfu1OHqiVnlDNxm4quxufu8/b5+zp2npq5zZa2zHmhvSZolLLJ2XegvG+buLjN3Nzn7pO0ymmWtUB6oWuYt/D1+DFwmitsl16PsHKduilqlkd/pIKowouuxqbB0ydplY+xyO7z9+Ts8snZ5Ojv9CJlkkqBpjRymzt3n1aKrEmApvT4+tnl7JGzyX2kvy5tmN3n7jBvmV+QsHqjvoWqw8na5fL2+eDq8CNmk/r7/MLV4Sxsl5S0yvX4+pu5zo6wxzh1nr/S4EyCp9Lg6SFkkurw9YSpw/n7/EV9pC1tmM7d56XB01qMrmiWtUd/pdjk7LvQ3tfj6z95obrP3bXM2526z8jY5G2Zt12OsFiLrb7S3zVynIisxbfN3Mzc5uvx9ajC1JCyycTW4mGRsdHf6dPg6YyvxmaVtHCbuWeVtPf5+8XX4zd0nVKGqrnO3Jm4zaC90MPV4uXt8tfj7K3G12uYts/d53Seu9Th6svb5qS/0jx3nyRnlNXi6qzF1j54oLPK2SC64g/iMAYAAAABYktHRACIBR1IAAAAB3RJTUUH5wkbAR0AszM1XgAAAAFvck5UAc+id5oAAAn1SURBVHja7d35fxx1GcDxbSnYyiFQRGzHlrYIpIKAkQIeHK1oAYscSkVutdZyKAiIWJRyiRQUFQQFUUDFG/C+b5R/y9nZZNkkm6Vjprv7fb7v9y+Z7Oym7ZNnPq+8Npu01QIAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABI36IxtTiYUc8zzmcs2r+HvWnUfW201fssGUv77LtfKOM65/Q+Y8OaZLQNzNOi/UZd2CZjveQ1Y2lJpCGXFo/pnNP7jA1rktE2ME+LI30WxXo4xDq1SUbbwDyJtUulNrFObZLRNjBPYu1SqU2sU5tktA3Mk1i7VGoT69QmGW0D8yTWLpXaxDq1SUbbwDyJtUulNrFObZLRNjBPYu1SqU2sU5tktA3Mk1i7VGoT69QmGW0D8yTWLpXaxDq1SUbbwDyJtUulNrFObZLRNjBPYu1SqU2sU5tktA3Mk1i7VGoT69QmGW0D8yTWLpXaxDq1SUbbwDyJtUulNrFObZLRNjBPYu1SqU2sU5tktA3Mk1i7VGoT69QmGW0D8yTWLpXaxDq1SUbbwDyJtUulNrFObZLRNjBPYu1SqU2sU5tktA3M096M9dKlr3KHZa8deHr/ZTX/QLEeDrFObZLRNjBPzcT6gAMPPKj7zusOPuTQ5a3DXn/4G44Y9Jg3rlhZHD7g/JtWrV55ZL2/hlgPh1inNsloG5inZmK9pijWdt9ZVxTFUa03ry6Ko48Z8JhjJ4pi9fr5z7+l/DAHHlfrryHWwyHWqU0y2gbmqflYH19W+q3l2xPK2J446EEnlXd42/ynJ1d2z7/95Dk29HuKRayHQ6xTm2S0DcxT87E+pWzsqeXb08q37xj0oHeWd3jXgPPvLs+ffkb76OBirjP7PEKsh0OsU5tktA3MU/Oxbn/BfFb5dunRRbGx9zuIm94zS7u5Z8+8adVhPQ94b3n+fe1nUsR6vIh1apOMtoF5ajzWyzcXxTnVc9Xnlkk9redO5xV7YLLnAe/fUt5wfnnwgQtmulCsR0qsU5tktA3MU+OxvqgM6cXV0RkTRfHBnjvVjnXrQ+UNF14y94/bKtYjJdapTTLaBuap8Vh/uAzp0esq7fh2jqrnrtuxvvQjA7wS68suv+KKU8q3V5a3XDX3jxPr0RLr1CYZbQPz1HSsl1/d7+vla9qn2rH+6KCP8rFurM8ojz5evp3cvO3Uy+beUaxHS6xTm2S0DcxT07H+RFEz1ts/2T2cG+vWjmv7/XFiPVpindoko21gnhqO9fr2i6Ovu75yQ3n4qc7hhva53lif9+kbb6oObtpy3cX7T93YJ9b9ifVoiXVqk4y2gXlaaKw/c1Lb6UWxsXxzc+uW9tfRt3ZOfbY8vKjnrj2xPu22ovhc9WMtt7e/h/j546tb+8R656mz3NG+VaxHS6xTm2S0DczTQmO9s/fZjtO/8MU9ifWdB1X33tU+vqE6vOvue1p9Y33v7CdUqq/CxXq0xDq1SUbbwDw1G+tVxYBY37ljx46jyrfHrqjue2h14/L7Ot+R/NKJrdbk/ffff091q1iPNbFObZLRNjBPC4319nVfLpXxXFm+2TYxKNYdD2zYXX3L8djpGx68fXX7homHvvLKnWbEeu30jzd+VazHg1inNsloG5inRr/BuK7z1e/DmypfKw+/Xh298uq7Xd/o3OX23h8rn3ykuu3Rb3ZvmRHr7q/ue0ysx4NYpzbJaBuYpyZj/Xj7p15O6PPKvW9N3e3bKzrvb3xi1uMfu6198+Ynp38jqliPNbFObZLRNjBPTcZ6/e5i4jtPDYj1dzvPktx85pwPcO33qlNnTb0r1mNNrFObZLQNzFOjT4OcXVzQGhTrp9tfVW89s99HOGbr6qK4cvo9sR5rYp3aJKNtYJ4ajfW9z9zRjvXVp1SebT83XR19f/p+j9529/L5PsYPttw1/dMxM2O97IdTnhPr8SDWqU0y2gbmqdFYb3q81Y711KtBJue+GuTBmwZ8kDu6LxDx0r3xJtapTTLaBuap8d+6NzDWrSd+NMCPu3cT67Em1qlNMtoG5mnIsd5QDPCT7t3EeqyJdWqTjLaBeUog1j/92ZQnxXo8iHVqk4y2gXnaG7G+8OeVQ8qk/qI6erJ7x+e39Zgoione91/o3s2rQcaaWKc2yWgbmKdmY/3A9oEv3Zvl0qK4sf8ZsR5rYp3aJKNtYJ4ajPWLz11f/LK1SqzDXypindoko21gnhqL9a8e2lgmtBPrZyqXF9OHv+7/KLFOlFinNsloG5inxmLdUcV64G/d67GHsX7qgCnXiPV4EOvUJhltA/O08Fhf9puDTu78atRi8/PLXuXVIDPsYay9dG/ciHVqk4y2gXlaaKyfuHF395np325vvdpL92YQ60SJdWqTjLaBeVporH83FdHVj/y+8/tNm431H656fqbqf2sU69ES69QmGW0D87TQWP+xXeqVj/zp+Okbmo11f2I9WmKd2iSjbWCeFhrr4zY+c8HTPf8hV/U6662VI8qjP3cOt/6l32P/71j/VaxHSqxTm2S0DczTgr/BuP64me/3+6GYoji/PHPkCbOUt981+7bOb94bHOulW8rTL/Y5IdbDIdapTTLaBuapmZfu9Zg/1n8r9sDfqw8yf6z/8ex95/6zPHtOv5NiPRxindoko21gnvZKrP8127ZdrWZifczDU/d7od9ZsR4OsU5tktE2ME97I9a39j9zycl74N/VXef/yvqFTquvmOx3UqyHQ6xTm2S0DcxT47G+at5Y1zB/rF9as2bNf9becl7fk2I9HGKd2iSjbWCeGo/1+pde+u+CP8hhO3fufLD+w8R6OMQ6tUlG28A8NR7rURLr4RDr1CYZbQPzJNYuldrEOrVJRtvAPIm1S6U2sU5tktE2ME9i7VKpTaxTm2S0DcyTWLtUahPr1CYZbQPzJNYuldrEOrVJRtvAPIm1S6U2sU5tktE2ME9i7VKpTaxTm2S0DcyTWLtUahPr1CYZbQPzJNYuldrEOrVJRtvAPIm1S6U2sU5tktE2ME9i7VKpTaxTm2S0DcyTWLtUahPr1CYZbQPzJNYuldrEOrVJRtvAPIm1S6U2sU5tktE2ME9i7VKpTaxTm2S0DcyTWLtUahPr1CYZbQPzJNYuldrEOrVJRtvAPIm1S6U2sU5tktE2ME9i7VKpTaxTm2S0DcyTWLtUahPr1CYZbQPzFCvWLy8ZSy8vWhzKuM45vc/YsCYZbQPztChSrFv7jqn9ghn1PON8xqL9e9ibRt1XAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAIDM/A8jeo+OxkYHGgAAACV0RVh0ZGF0ZTpjcmVhdGUAMjAyMy0wOS0yN1QwMToyOTowMCswMDowMLuNdVMAAAAldEVYdGRhdGU6bW9kaWZ5ADIwMjMtMDktMjdUMDE6Mjk6MDArMDA6MDDK0M3vAAAAKHRFWHRkYXRlOnRpbWVzdGFtcAAyMDIzLTA5LTI3VDAxOjI5OjAwKzAwOjAwncXsMAAAAABJRU5ErkJggg==" alt=""/><br/>压缩：</p><p><img src="data:image/png;base64,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" alt=""/><br/>复制：</p><p><img src="data:image/png;base64,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" alt=""/><br/>JVM在具体进行垃圾回收的时候，会进行分代回收。绝大多数的Java对象存活时间都非常短，很多时候就是在一个方法内创建对象，对象引用放在栈中，当方法调用结束，栈帧出栈的时候，这个对象就失去引用了，成为垃圾。针对这种情况，JVM将堆空间分成新生代（young）和老年代（old）两个区域，创建对象的时候，只在新生代创建，当新生代空间不足的时候，只对新生代进行垃圾回收，这样需要处理的内存空间就比较小，垃圾回收速度就比较快。</p><p>新生代又分为Eden区、From区和To区三个区域，每次垃圾回收都是扫描Eden区和From区，将存活对象复制到To区，然后交换From区和To区的名称引用，下次垃圾回收的时候继续将存活对象从From区复制到To区。当一个对象经过几次新生代垃圾回收，也就是几次从From区复制到To区以后，依然存活，那么这个对象就会被复制到老年代区域。</p><p>当老年代空间已满，也就是无法将新生代中多次复制后依然存活的对象复制进去的时候，就会对新生代和老年代的内存空间进行一次全量垃圾回收，即Full GC。所以根据应用程序的对象存活时间，合理设置老年代和新生代的空间比例对JVM垃圾回收的性能有很大影响，JVM设置老年代新生代比例的参数是-XX:NewRatio。</p><p><img src="/blog-backend/static/httpsstatic001geekbangorgresourceimagea5f4a5c3dbd6e992822d253f4d16b05555f4.c26a6b4e.png" alt=""/><br/>JVM中，具体执行垃圾回收的垃圾回收器有四种。</p><p><strong>第一种是Serial 串行垃圾回收器</strong>，这是JVM早期的垃圾回收器，只有一个线程执行垃圾回收。</p><p><strong>第二种是Parallel 并行垃圾回收器</strong>，它启动多线程执行垃圾回收。如果JVM运行在多核CPU上，那么显然并行垃圾回收要比串行垃圾回收效率高。</p><p>在串行和并行垃圾回收过程中，当垃圾回收线程工作的时候，必须要停止用户线程的工作，否则可能会导致对象的引用标记错乱，因此垃圾回收过程也被称为stop the world，在用户视角看来，所有的程序都不再执行，整个世界都停止了。</p><p><strong>第三种CMS 并发垃圾回收器</strong>，在垃圾回收的某些阶段，垃圾回收线程和用户线程可以并发运行，因此对用户线程的影响较小。Web应用这类对用户响应时间比较敏感的场景，适用CMS垃圾回收器。</p><p><strong>最后一种是G1 垃圾回收器</strong>，它将整个堆空间分成多个子区域，然后在这些子区域上各自独立进行垃圾回收，在回收过程中垃圾回收线程和用户线程也是并发运行。G1综合了以前几种垃圾回收器的优势，适用于各种场景，是未来主要的垃圾回收器。</p><p><img src="/blog-backend/static/httpsstatic001geekbangorgresourceimage4934492f81e739aba5664ebaf0e08b467134.53b52399.png" alt=""/></p><h2 id="小结"><a aria-hidden="true" tabindex="-1" href="/blog-backend/后端技术面试38讲/02.软件的基础原理/03#小结"><span class="icon icon-link"></span></a>小结</h2><p>我们为什么需要了解JVM呢？JVM有很多配置参数，Java开发过程中也可能会遇到各种问题，了解了JVM的基本构造，就可以帮助我们从原理上去解决问题。</p><p>比如遇到OutOfMemoryError，我们就知道是堆空间不足了，可能是JVM分配的内存空间不足以让程序正常运行，这时候我们需要通过调整-Xmx参数增加内存空间。也可能是程序存在内存泄漏，比如一些对象被放入List或者Map等容器对象中，虽然这些对象程序已经不再使用了，但是这些对象依然被容器对象引用，无法进行垃圾回收，导致内存溢出，这时候可以通过jmap命令查看堆中的对象情况，分析是否有内存泄漏。</p><p>如果遇到StackOverflowError，我们就知道是线程栈空间不足，栈空间不足通常是因为方法调用的层次太多，导致栈帧太多。我们可以先通过栈异常信息观察是否存在错误的递归调用，因为每次递归都会使嵌套方法调用更深入一层。如果调用是正常的，可以尝试调整-Xss参数增加栈空间大小。</p><p>如果程序运行卡顿，部分请求响应延迟比较厉害，那么可以通过jstat命令查看垃圾回收器的运行状况，是否存在较长时间的FullGC，然后调整垃圾回收器的相关参数，使垃圾回收对程序运行的影响尽可能小。</p><p>执行引擎在执行字节码指令的时候，是解释执行的，也就是每个字节码指令都会被解释成一个底层的CPU指令，但是这样的解释执行效率比较差，JVM对此进行了优化，将频繁执行的代码编译为底层CPU指令存储起来，后面再执行的时候，直接执行编译好的指令，不再解释执行，这就是JVM的即时编译JIT。Web应用程序通常是长时间运行的，使用JIT会有很好的优化效果，可以通过-server参数打开JIT的C2编译器进行优化。</p><p>总之，如果你理解了JVM的构造，在进行Java开发的时候，遇到各种问题，都可以思考一下，这在JVM层面是如何的？然后进一步查找资料、分析问题，这样就会真正解决问题，而且经过这样不断地思考分析，你对Java，对JVM，甚至对整个计算机的原理体系以及设计理念都会有更多认识和领悟。</p><h2 id="思考题"><a aria-hidden="true" tabindex="-1" href="/blog-backend/后端技术面试38讲/02.软件的基础原理/03#思考题"><span class="icon icon-link"></span></a>思考题</h2><p>你在Java开发过程中遇到过什么样的问题？这些问题和JVM底层原理是怎样的关系？</p><p>你有想过这些问题吗？你可以把你的疑惑或者想法写在评论区里，集思广益。也欢迎你把这篇文章分享给你的朋友或者同事，一起交流一下。</p></div><div class="__dumi-default-layout-footer-meta"><a target="_blank" rel="noopener noreferrer" href="https://github.com/GGwujun/blog/edit/master/ssrc/后端技术面试38讲/02.软件的基础原理/03.md">在 GitHub 上编辑此页<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="__dumi-default-external-link-icon"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a><span data-updated-text="最后更新时间：">2023/9/27 11:15:40</span></div></div></div></div>
	<script>
  window.g_useSSR = true;
  window.g_initialProps = {};
	</script>

    <script>
      (function () {
        if (!location.port) {
          (function (i, s, o, g, r, a, m) {
            i["GoogleAnalyticsObject"] = r;
            (i[r] =
              i[r] ||
              function () {
                (i[r].q = i[r].q || []).push(arguments);
              }),
              (i[r].l = 1 * new Date());
            (a = s.createElement(o)), (m = s.getElementsByTagName(o)[0]);
            a.async = 1;
            a.src = g;
            m.parentNode.insertBefore(a, m);
          })(
            window,
            document,
            "script",
            "//www.google-analytics.com/analytics.js",
            "ga"
          );
          ga("create", "UA-149864185-1", "auto");
          ga("send", "pageview");
        }
      })();
    </script>
    <script src="/blog-backend/umi.e14e5a14.js"></script>
  </body>
</html>
