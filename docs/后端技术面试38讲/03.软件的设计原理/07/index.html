<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1, maximum-scale=1, minimum-scale=1, user-scalable=no"
    />
    <link rel="shortcut icon" type="image/x-icon" href="/logo.png" />
    <link rel="stylesheet" href="/blog-backend/umi.3ec1f225.css" />
    <script>
      window.routerBase = "/blog-backend";
    </script>
    <script>
      //! umi version: 3.5.41
    </script>
    <script>
      !(function () {
        var e =
            navigator.cookieEnabled && void 0 !== window.localStorage
              ? localStorage.getItem("dumi:prefers-color")
              : "auto",
          o = window.matchMedia("(prefers-color-scheme: dark)").matches,
          t = ["light", "dark", "auto"];
        document.documentElement.setAttribute(
          "data-prefers-color",
          e === t[2] ? (o ? t[1] : t[0]) : t.indexOf(e) > -1 ? e : t[0]
        );
      })();
    </script>
    <title>
      14 | 软件设计的单一职责原则：为什么说一个类文件打开最好不要超过一屏？ -
      大师兄
    </title>
  </head>
  <body>
    <div id="root"><div class="__dumi-default-layout" data-route="/后端技术面试38讲/03.软件的设计原理/07" data-show-sidemenu="true" data-show-slugs="true" data-site-mode="true" data-gapless="false"><div class="__dumi-default-navbar" data-mode="site"><button class="__dumi-default-navbar-toggle"></button><a class="__dumi-default-navbar-logo" style="background-image:url(&#x27;/logo.png&#x27;)" href="/blog-backend/">大师兄</a><nav><div class="__dumi-default-search"><input type="search" class="__dumi-default-search-input" value=""/><ul></ul></div><span>后端开发<ul><li><a href="/blog-backend/go语言核心36讲">go语言核心36讲</a></li><li><a href="/blog-backend/go并发编程实战">go并发编程实战</a></li><li><a href="/blog-backend/go语言项目开发实战">go语言项目开发实战</a></li><li><a href="/blog-backend/kafka核心技术与实战">kafka核心技术与实战</a></li><li><a href="/blog-backend/kafka核心源码解读">kafka核心源码解读</a></li><li><a href="/blog-backend/零基础学python">零基础学python</a></li><li><a href="/blog-backend/python核心技术与实战">python核心技术与实战</a></li><li><a href="/blog-backend/redis核心技术与实战">redis核心技术与实战</a></li><li><a href="/blog-backend/redis源码剖析与实战">redis源码剖析与实战</a></li><li><a href="/blog-backend/陈天rust编程第一课">陈天rust编程第一课</a></li><li><a href="/blog-backend/tonybaigo语言第一课">tonybaigo语言第一课</a></li><li><a href="/blog-backend/后端存储实战课">后端存储实战课</a></li><li><a aria-current="page" class="active" href="/blog-backend/后端技术面试38讲">后端技术面试38讲</a></li><li><a href="/blog-backend/深入c语言和程序运行原理">深入c语言和程序运行原理</a></li><li><a href="/blog-backend/现代c编程实战">现代c编程实战</a></li><li><a href="/blog-backend/罗剑锋的c实战笔记">罗剑锋的c实战笔记</a></li><li><a href="/blog-backend/零基础入门spark">零基础入门spark</a></li></ul></span><span>架构师<ul><li><a href="/blog-backend/mysql实战45讲">mysql实战45讲</a></li><li><a href="/blog-backend/数据中台实战课">数据中台实战课</a></li></ul></span><div class="__dumi-default-navbar-tool"><div class="__dumi-default-dark"><div class="__dumi-default-dark-switch "></div></div></div></nav></div><div class="__dumi-default-menu" data-mode="site"><div class="__dumi-default-menu-inner"><div class="__dumi-default-menu-header"><a class="__dumi-default-menu-logo" style="background-image:url(&#x27;/logo.png&#x27;)" href="/blog-backend/"></a><h1>大师兄</h1><p></p></div><div class="__dumi-default-menu-mobile-area"><ul class="__dumi-default-menu-nav-list"><li>后端开发<ul><li><a href="/blog-backend/go语言核心36讲">go语言核心36讲</a></li><li><a href="/blog-backend/go并发编程实战">go并发编程实战</a></li><li><a href="/blog-backend/go语言项目开发实战">go语言项目开发实战</a></li><li><a href="/blog-backend/kafka核心技术与实战">kafka核心技术与实战</a></li><li><a href="/blog-backend/kafka核心源码解读">kafka核心源码解读</a></li><li><a href="/blog-backend/零基础学python">零基础学python</a></li><li><a href="/blog-backend/python核心技术与实战">python核心技术与实战</a></li><li><a href="/blog-backend/redis核心技术与实战">redis核心技术与实战</a></li><li><a href="/blog-backend/redis源码剖析与实战">redis源码剖析与实战</a></li><li><a href="/blog-backend/陈天rust编程第一课">陈天rust编程第一课</a></li><li><a href="/blog-backend/tonybaigo语言第一课">tonybaigo语言第一课</a></li><li><a href="/blog-backend/后端存储实战课">后端存储实战课</a></li><li><a aria-current="page" class="active" href="/blog-backend/后端技术面试38讲">后端技术面试38讲</a></li><li><a href="/blog-backend/深入c语言和程序运行原理">深入c语言和程序运行原理</a></li><li><a href="/blog-backend/现代c编程实战">现代c编程实战</a></li><li><a href="/blog-backend/罗剑锋的c实战笔记">罗剑锋的c实战笔记</a></li><li><a href="/blog-backend/零基础入门spark">零基础入门spark</a></li></ul></li><li>架构师<ul><li><a href="/blog-backend/mysql实战45讲">mysql实战45讲</a></li><li><a href="/blog-backend/数据中台实战课">数据中台实战课</a></li></ul></li></ul><div class="__dumi-default-dark"><div class="__dumi-default-dark-switch "><button title="Dark theme" class="__dumi-default-dark-moon "><svg viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="3854" width="22" height="22"><path d="M991.816611 674.909091a69.166545 69.166545 0 0 0-51.665455-23.272727 70.795636 70.795636 0 0 0-27.438545 5.585454A415.674182 415.674182 0 0 1 754.993338 698.181818c-209.594182 0-393.472-184.785455-393.472-395.636363 0-52.363636 38.539636-119.621818 69.515637-173.614546 4.887273-8.610909 9.634909-16.756364 14.103272-24.901818A69.818182 69.818182 0 0 0 384.631156 0a70.842182 70.842182 0 0 0-27.438545 5.585455C161.678429 90.298182 14.362065 307.898182 14.362065 512c0 282.298182 238.824727 512 532.38691 512a522.286545 522.286545 0 0 0 453.957818-268.334545A69.818182 69.818182 0 0 0 991.816611 674.909091zM546.679156 954.181818c-248.785455 0-462.941091-192-462.941091-442.181818 0-186.647273 140.637091-372.829091 300.939637-442.181818-36.817455 65.629091-92.578909 151.970909-92.578909 232.727273 0 250.181818 214.109091 465.454545 462.917818 465.454545a488.331636 488.331636 0 0 0 185.181091-46.545455 453.003636 453.003636 0 0 1-393.565091 232.727273z m103.656728-669.323636l-14.266182 83.781818a34.909091 34.909091 0 0 0 50.362182 36.770909l74.775272-39.563636 74.752 39.563636a36.142545 36.142545 0 0 0 16.174546 3.956364 34.909091 34.909091 0 0 0 34.210909-40.727273l-14.289455-83.781818 60.509091-59.345455a35.025455 35.025455 0 0 0-19.223272-59.578182l-83.61891-12.101818-37.376-76.101818a34.56 34.56 0 0 0-62.254545 0l-37.376 76.101818-83.618909 12.101818a34.909091 34.909091 0 0 0-19.246546 59.578182z m70.423272-64.698182a34.280727 34.280727 0 0 0 26.135273-19.083636l14.312727-29.090909 14.336 29.090909a34.257455 34.257455 0 0 0 26.135273 19.083636l32.046546 4.887273-23.272728 22.574545a35.234909 35.234909 0 0 0-10.007272 30.952727l5.46909 32.116364-28.625454-15.127273a34.490182 34.490182 0 0 0-32.302546 0l-28.695272 15.127273 5.469091-32.116364a35.141818 35.141818 0 0 0-9.984-30.952727l-23.272728-22.574545z" p-id="3855"></path></svg></button><button title="Light theme" class="__dumi-default-dark-sun "><svg viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="4026" width="22" height="22"><path d="M915.2 476.16h-43.968c-24.704 0-44.736 16-44.736 35.84s20.032 35.904 44.736 35.904H915.2c24.768 0 44.8-16.064 44.8-35.904s-20.032-35.84-44.8-35.84zM512 265.6c-136.704 0-246.464 109.824-246.464 246.4 0 136.704 109.76 246.464 246.464 246.464S758.4 648.704 758.4 512c0-136.576-109.696-246.4-246.4-246.4z m0 425.6c-99.008 0-179.2-80.128-179.2-179.2 0-98.944 80.192-179.2 179.2-179.2S691.2 413.056 691.2 512c0 99.072-80.192 179.2-179.2 179.2zM197.44 512c0-19.84-19.136-35.84-43.904-35.84H108.8c-24.768 0-44.8 16-44.8 35.84s20.032 35.904 44.8 35.904h44.736c24.768 0 43.904-16.064 43.904-35.904zM512 198.464c19.776 0 35.84-20.032 35.84-44.8v-44.8C547.84 84.032 531.84 64 512 64s-35.904 20.032-35.904 44.8v44.8c0 24.768 16.128 44.864 35.904 44.864z m0 627.136c-19.776 0-35.904 20.032-35.904 44.8v44.736C476.096 940.032 492.16 960 512 960s35.84-20.032 35.84-44.8v-44.736c0-24.768-16.064-44.864-35.84-44.864z m329.92-592.832c17.472-17.536 20.288-43.072 6.4-57.024-14.016-14.016-39.488-11.2-57.024 6.336-4.736 4.864-26.496 26.496-31.36 31.36-17.472 17.472-20.288 43.008-6.336 57.024 13.952 14.016 39.488 11.2 57.024-6.336 4.8-4.864 26.496-26.56 31.296-31.36zM213.376 759.936c-4.864 4.8-26.56 26.624-31.36 31.36-17.472 17.472-20.288 42.944-6.4 56.96 14.016 13.952 39.552 11.2 57.024-6.336 4.8-4.736 26.56-26.496 31.36-31.36 17.472-17.472 20.288-43.008 6.336-56.96-14.016-13.952-39.552-11.072-56.96 6.336z m19.328-577.92c-17.536-17.536-43.008-20.352-57.024-6.336-14.08 14.016-11.136 39.488 6.336 57.024 4.864 4.864 26.496 26.56 31.36 31.424 17.536 17.408 43.008 20.288 56.96 6.336 14.016-14.016 11.264-39.488-6.336-57.024-4.736-4.864-26.496-26.56-31.296-31.424z m527.168 628.608c4.864 4.864 26.624 26.624 31.36 31.424 17.536 17.408 43.072 20.224 57.088 6.336 13.952-14.016 11.072-39.552-6.4-57.024-4.864-4.8-26.56-26.496-31.36-31.36-17.472-17.408-43.072-20.288-57.024-6.336-13.952 14.016-11.008 39.488 6.336 56.96z" p-id="4027"></path></svg></button><button title="Default to system" class="__dumi-default-dark-auto "><svg viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="11002" width="22" height="22"><path d="M127.658667 492.885333c0-51.882667 10.24-101.717333 30.378666-149.162666s47.786667-88.064 81.92-122.538667 75.093333-61.781333 122.538667-81.92 96.938667-30.378667 149.162667-30.378667 101.717333 10.24 149.162666 30.378667 88.405333 47.786667 122.88 81.92 61.781333 75.093333 81.92 122.538667 30.378667 96.938667 30.378667 149.162666-10.24 101.717333-30.378667 149.162667-47.786667 88.405333-81.92 122.88-75.093333 61.781333-122.88 81.92-97.28 30.378667-149.162666 30.378667-101.717333-10.24-149.162667-30.378667-88.064-47.786667-122.538667-81.92-61.781333-75.093333-81.92-122.88-30.378667-96.938667-30.378666-149.162667z m329.045333 0c0 130.048 13.994667 244.394667 41.984 343.381334h12.970667c46.762667 0 91.136-9.216 133.461333-27.306667s78.848-42.666667 109.568-73.386667 54.954667-67.242667 73.386667-109.568 27.306667-86.698667 27.306666-133.461333c0-46.421333-9.216-90.794667-27.306666-133.12s-42.666667-78.848-73.386667-109.568-67.242667-54.954667-109.568-73.386667-86.698667-27.306667-133.461333-27.306666h-11.605334c-28.672 123.562667-43.349333 237.909333-43.349333 343.722666z" p-id="11003"></path></svg></button></div></div></div><ul class="__dumi-default-menu-list"><li><a href="/blog-backend/后端技术面试38讲">后端技术面试38讲</a></li><li><a href="/blog-backend/后端技术面试38讲/01.开篇词">01.开篇词</a><ul><li><a href="/blog-backend/后端技术面试38讲/01.开篇词/01"><span>开篇词 | 掌握软件开发技术的第一性原理</span></a></li></ul></li><li><a href="/blog-backend/后端技术面试38讲/02.软件的基础原理">02.软件的基础原理</a><ul><li><a href="/blog-backend/后端技术面试38讲/02.软件的基础原理/01"><span>01丨程序运行原理：程序是如何运行又是如何崩溃的？</span></a></li><li><a href="/blog-backend/后端技术面试38讲/02.软件的基础原理/02"><span>02丨数据结构原理：Hash表的时间复杂度为什么是O(1)？</span></a></li><li><a href="/blog-backend/后端技术面试38讲/02.软件的基础原理/03"><span>03丨Java虚拟机原理：JVM为什么被称为机器（machine）？</span></a></li><li><a href="/blog-backend/后端技术面试38讲/02.软件的基础原理/04"><span>04丨网络编程原理：一个字符的互联网之旅</span></a></li><li><a href="/blog-backend/后端技术面试38讲/02.软件的基础原理/05"><span>05丨文件系统原理：如何用1分钟遍历一个100TB的文件？</span></a></li><li><a href="/blog-backend/后端技术面试38讲/02.软件的基础原理/06"><span>06丨数据库原理：为什么PrepareStatement性能更好更安全？</span></a></li><li><a href="/blog-backend/后端技术面试38讲/02.软件的基础原理/07"><span>07丨编程语言原理：面向对象编程是编程的终极形态吗？</span></a></li><li><a href="/blog-backend/后端技术面试38讲/02.软件的基础原理/08"><span>答疑丨Java Web程序的运行时环境到底是怎样的？</span></a></li></ul></li><li><a aria-current="page" class="active" href="/blog-backend/后端技术面试38讲/03.软件的设计原理">03.软件的设计原理</a><ul><li><a href="/blog-backend/后端技术面试38讲/03.软件的设计原理/01"><span>08丨软件设计的方法论：软件为什么要建模？</span></a></li><li><a href="/blog-backend/后端技术面试38讲/03.软件的设计原理/02"><span>09丨软件设计实践：如何使用UML完成一个设计文档？</span></a></li><li><a href="/blog-backend/后端技术面试38讲/03.软件的设计原理/03"><span>10 | 软件设计的目的：糟糕的程序员比优秀的程序员差在哪里？</span></a></li><li><a href="/blog-backend/后端技术面试38讲/03.软件的设计原理/04"><span>11丨软件设计的开闭原则：如何不修改代码却能实现需求变更？</span></a></li><li><a href="/blog-backend/后端技术面试38讲/03.软件的设计原理/05"><span>12 | 软件设计的依赖倒置原则：如何不依赖代码却可以复用它的功能？</span></a></li><li><a href="/blog-backend/后端技术面试38讲/03.软件的设计原理/06"><span>13丨软件设计的里氏替换原则：正方形可以继承长方形吗？</span></a></li><li><a aria-current="page" class="active" href="/blog-backend/后端技术面试38讲/03.软件的设计原理/07"><span>14 | 软件设计的单一职责原则：为什么说一个类文件打开最好不要超过一屏？</span></a></li><li><a href="/blog-backend/后端技术面试38讲/03.软件的设计原理/08"><span>15丨软件设计的接口隔离原则：如何对类的调用者隐藏类的公有方法？</span></a></li><li><a href="/blog-backend/后端技术面试38讲/03.软件的设计原理/09"><span>16 | 设计模式基础：不会灵活应用设计模式，你就没有掌握面向对象编程</span></a></li><li><a href="/blog-backend/后端技术面试38讲/03.软件的设计原理/10"><span>17 | 设计模式应用：编程框架中的设计模式</span></a></li><li><a href="/blog-backend/后端技术面试38讲/03.软件的设计原理/11"><span>18 | 反应式编程框架设计：如何使程序调用不阻塞等待，立即响应？</span></a></li><li><a href="/blog-backend/后端技术面试38讲/03.软件的设计原理/12"><span>19 | 组件设计原则：组件的边界在哪里？</span></a></li><li><a href="/blog-backend/后端技术面试38讲/03.软件的设计原理/13"><span>20 | 领域驱动设计：35岁的程序员应该写什么样的代码？</span></a></li><li><a href="/blog-backend/后端技术面试38讲/03.软件的设计原理/14"><span>答疑丨对于设计模式而言，场景到底有多重要？</span></a></li></ul></li><li><a href="/blog-backend/后端技术面试38讲/04.架构的核心原理">04.架构的核心原理</a><ul><li><a href="/blog-backend/后端技术面试38讲/04.架构的核心原理/01"><span>21丨分布式架构：如何应对高并发的用户请求</span></a></li><li><a href="/blog-backend/后端技术面试38讲/04.架构的核心原理/02"><span>22 | 缓存架构：如何减少不必要的计算？</span></a></li><li><a href="/blog-backend/后端技术面试38讲/04.架构的核心原理/03"><span>23 | 异步架构：如何避免互相依赖的系统间耦合？</span></a></li><li><a href="/blog-backend/后端技术面试38讲/04.架构的核心原理/04"><span>24 | 负载均衡架构：如何用10行代码实现一个负载均衡服务？</span></a></li><li><a href="/blog-backend/后端技术面试38讲/04.架构的核心原理/05"><span>25 | 数据存储架构：如何改善系统的数据存储能力？</span></a></li><li><a href="/blog-backend/后端技术面试38讲/04.架构的核心原理/06"><span>26 | 搜索引擎架构：如何瞬间完成海量数据检索？</span></a></li><li><a href="/blog-backend/后端技术面试38讲/04.架构的核心原理/07"><span>27 | 微服务架构：微服务究竟是灵丹还是毒药？</span></a></li><li><a href="/blog-backend/后端技术面试38讲/04.架构的核心原理/08"><span>28 | 高性能架构：除了代码，你还可以在哪些地方优化性能？</span></a></li><li><a href="/blog-backend/后端技术面试38讲/04.架构的核心原理/09"><span>29 | 高可用架构：我们为什么感觉不到淘宝应用升级时的停机？</span></a></li><li><a href="/blog-backend/后端技术面试38讲/04.架构的核心原理/10"><span>30 | 安全性架构：为什么说用户密码泄漏是程序员的锅？</span></a></li><li><a href="/blog-backend/后端技术面试38讲/04.架构的核心原理/11"><span>31 | 大数据架构：大数据技术架构的思想和原理是什么？</span></a></li><li><a href="/blog-backend/后端技术面试38讲/04.架构的核心原理/12"><span>32 | AI与物联网架构：从智能引擎到物联网平台</span></a></li><li><a href="/blog-backend/后端技术面试38讲/04.架构的核心原理/13"><span>33 | 区块链技术架构：区块链到底能做什么？</span></a></li><li><a href="/blog-backend/后端技术面试38讲/04.架构的核心原理/14"><span>答疑丨互联网需要解决的技术问题是什么？</span></a></li></ul></li><li><a href="/blog-backend/后端技术面试38讲/05.技术人的思维修炼">05.技术人的思维修炼</a><ul><li><a href="/blog-backend/后端技术面试38讲/05.技术人的思维修炼/01"><span>34 | 技术修炼之道：同样工作十几年，为什么有的人成为大厂架构师，有的人失业？</span></a></li><li><a href="/blog-backend/后端技术面试38讲/05.技术人的思维修炼/02"><span>35 | 技术进阶之道：你和这个星球最顶级的程序员差几个等级？</span></a></li><li><a href="/blog-backend/后端技术面试38讲/05.技术人的思维修炼/03"><span>36丨技术落地之道：你真的知道自己要解决的问题是什么吗？</span></a></li><li><a href="/blog-backend/后端技术面试38讲/05.技术人的思维修炼/04"><span>37丨技术沟通之道：如何解决问题？</span></a></li><li><a href="/blog-backend/后端技术面试38讲/05.技术人的思维修炼/05"><span>38丨技术管理之道：你真的要转管理吗？</span></a></li><li><a href="/blog-backend/后端技术面试38讲/05.技术人的思维修炼/06"><span>答疑丨工作中的交往和沟通，都有哪些小技巧呢？</span></a></li></ul></li><li><a href="/blog-backend/后端技术面试38讲/06.不定期加餐">06.不定期加餐</a><ul><li><a href="/blog-backend/后端技术面试38讲/06.不定期加餐/01"><span>加餐 | 软件设计文档示例模板</span></a></li></ul></li><li><a href="/blog-backend/后端技术面试38讲/07.结束语">07.结束语</a><ul><li><a href="/blog-backend/后端技术面试38讲/07.结束语/01"><span>结束语丨期待未来的你，成为优秀的软件架构师</span></a></li></ul></li><li><a href="/blog-backend/后端技术面试38讲/08.期末考试">08.期末考试</a><ul><li><a href="/blog-backend/后端技术面试38讲/08.期末考试/01"><span>期末测试丨快来测测你对专栏内容掌握到何种程度了</span></a></li></ul></li><li><a href="/blog-backend/后端技术面试38讲/summary">后端技术面试38讲</a></li></ul></div></div><ul role="slug-list" class="__dumi-default-layout-toc"><li title="单一职责原则" data-depth="2"><a href="/blog-backend/后端技术面试38讲/03.软件的设计原理/07#单一职责原则"><span>单一职责原则</span></a></li><li title="一个违反单一职责原则的例子" data-depth="2"><a href="/blog-backend/后端技术面试38讲/03.软件的设计原理/07#一个违反单一职责原则的例子"><span>一个违反单一职责原则的例子</span></a></li><li title="从Web应用架构演进看单一职责原则" data-depth="2"><a href="/blog-backend/后端技术面试38讲/03.软件的设计原理/07#从web应用架构演进看单一职责原则"><span>从Web应用架构演进看单一职责原则</span></a></li><li title="小结" data-depth="2"><a href="/blog-backend/后端技术面试38讲/03.软件的设计原理/07#小结"><span>小结</span></a></li><li title="思考题" data-depth="2"><a href="/blog-backend/后端技术面试38讲/03.软件的设计原理/07#思考题"><span>思考题</span></a></li></ul><div class="__dumi-default-layout-content"><div class="markdown"><h1 id="14--软件设计的单一职责原则为什么说一个类文件打开最好不要超过一屏"><a aria-hidden="true" tabindex="-1" href="/blog-backend/后端技术面试38讲/03.软件的设计原理/07#14--软件设计的单一职责原则为什么说一个类文件打开最好不要超过一屏"><span class="icon icon-link"></span></a>14 | 软件设计的单一职责原则：为什么说一个类文件打开最好不要超过一屏？</h1><p>我在Intel工作期间，曾经接手过一个大数据SQL引擎的开发工作（<a target="_blank" rel="noopener noreferrer" href="https://time.geekbang.org/column/article/71634">如何自己开发一个大数据SQL引擎？<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="__dumi-default-external-link-icon"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>）。我接手的时候，这个项目已经完成了早期的技术验证和架构设计，能够处理较为简单的标准SQL语句。后续公司打算成立一个专门的小组，开发支持完整的标准SQL语法的大数据引擎，然后进一步将这个产品商业化。</p><p>我接手后打开项目一看，吓出一身冷汗，这个项目只有几个类组成，其中最大的一个类，负责SQL语法的处理，有近万行代码。代码中充斥着大量的switch/case，if/else代码，而且方法之间互相调用，各种全局变量传递。</p><p>只有输入测试SQL语句的时候，在debug状态下才能理解每一行代码的意思。而这样的代码有1万行，现在只实现了不到10%的SQL语法特性。如果将SQL的全部语法特性都实现了，那么这个类该有多么大！逻辑有多么复杂！维护有多么困难！而且还要准备一个团队来合作开发！想想看，几个人在这样一个大文件里提交代码，想想都酸爽。</p><p>这是当时这个SQL语法处理类中的一个方法，而这样的方法有上百个。</p><div class="__dumi-default-code-block"><pre class="prism-code language-unknown"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token plain">/**</span></div><div class="token-line"><span class="token plain">       * Digest all Not Op and merge into subq or normal filter semantics</span></div><div class="token-line"><span class="token plain">       * After this process there should not be any NOT FB in the FB tree.</span></div><div class="token-line"><span class="token plain">       */</span></div><div class="token-line"><span class="token plain">      private void digestNotOp(FilterBlockBase fb, FBPrepContext ctx) {</span></div><div class="token-line"><span class="token plain">        // recursively digest the not op in a top down manner</span></div><div class="token-line"><span class="token plain">        if (fb.getType() == FilterBlockBase.Type.LOGIC_NOT) {</span></div><div class="token-line"><span class="token plain">          FilterBlockBase child = fb.getOnlyChild();</span></div><div class="token-line"><span class="token plain">          FilterBlockBase newOp = null;</span></div><div class="token-line"><span class="token plain">          switch (child.getType()) {</span></div><div class="token-line"><span class="token plain">          case LOGIC_AND:</span></div><div class="token-line"><span class="token plain">          case LOGIC_OR: {</span></div><div class="token-line"><span class="token plain">            // not (a and b) -&gt; (not a) or (not b)</span></div><div class="token-line"><span class="token plain">            newOp = (child.getType() == Type.LOGIC_AND) ? new OpORFilterBlock()</span></div><div class="token-line"><span class="token plain">                : new OpANDFilterBlock();</span></div><div class="token-line"><span class="token plain">            FilterBlockBase lhsNot = new OpNOTFilterBlock();</span></div><div class="token-line"><span class="token plain">            FilterBlockBase rhsNot = new OpNOTFilterBlock();</span></div><div class="token-line"><span class="token plain">            lhsNot.setOnlyChild(child.getLeftChild());</span></div><div class="token-line"><span class="token plain">            rhsNot.setOnlyChild(child.getRightChild());</span></div><div class="token-line"><span class="token plain">            newOp.setLeftChild(lhsNot);</span></div><div class="token-line"><span class="token plain">            newOp.setRightChild(rhsNot);</span></div><div class="token-line"><span class="token plain">            break;</span></div><div class="token-line"><span class="token plain">          }</span></div><div class="token-line"><span class="token plain">          case LOGIC_NOT:</span></div><div class="token-line"><span class="token plain">            newOp = child.getOnlyChild();</span></div><div class="token-line"><span class="token plain">            break;</span></div><div class="token-line"><span class="token plain">          case SUBQ: {</span></div><div class="token-line"><span class="token plain">            switch (((SubQFilterBlock) child).getOpType()) {</span></div><div class="token-line"><span class="token plain">            case ALL: {</span></div><div class="token-line"><span class="token plain">              ((SubQFilterBlock) child).setOpType(OPType.SOMEANY);</span></div><div class="token-line"><span class="token plain">              SqlASTNode op = ((SubQFilterBlock) child).getOp();</span></div><div class="token-line"><span class="token plain">              // Note: here we directly change the original SqlASTNode</span></div><div class="token-line"><span class="token plain">              revertRelationalOp(op);</span></div><div class="token-line"><span class="token plain">              break;</span></div><div class="token-line"><span class="token plain">            }</span></div><div class="token-line"><span class="token plain">            case SOMEANY: {</span></div><div class="token-line"><span class="token plain">              ((SubQFilterBlock) child).setOpType(OPType.ALL);</span></div><div class="token-line"><span class="token plain">              SqlASTNode op = ((SubQFilterBlock) child).getOp();</span></div><div class="token-line"><span class="token plain">              // Note: here we directly change the original SqlASTNode</span></div><div class="token-line"><span class="token plain">              revertRelationalOp(op);</span></div><div class="token-line"><span class="token plain">              break;</span></div><div class="token-line"><span class="token plain">            }</span></div><div class="token-line"><span class="token plain">            case RELATIONAL: {</span></div><div class="token-line"><span class="token plain">              SqlASTNode op = ((SubQFilterBlock) child).getOp();</span></div><div class="token-line"><span class="token plain">              // Note: here we directly change the original SqlASTNode</span></div><div class="token-line"><span class="token plain">              revertRelationalOp(op);</span></div><div class="token-line"><span class="token plain">              break;</span></div><div class="token-line"><span class="token plain">            }</span></div><div class="token-line"><span class="token plain">            case EXISTS:</span></div><div class="token-line"><span class="token plain">              ((SubQFilterBlock) child).setOpType(OPType.NOTEXISTS);</span></div><div class="token-line"><span class="token plain">              break;</span></div><div class="token-line"><span class="token plain">            case NOTEXISTS:</span></div><div class="token-line"><span class="token plain">              ((SubQFilterBlock) child).setOpType(OPType.EXISTS);</span></div><div class="token-line"><span class="token plain">              break;</span></div><div class="token-line"><span class="token plain">            case IN:</span></div><div class="token-line"><span class="token plain">              ((SubQFilterBlock) child).setOpType(OPType.NOTIN);</span></div><div class="token-line"><span class="token plain">              break;</span></div><div class="token-line"><span class="token plain">            case NOTIN:</span></div><div class="token-line"><span class="token plain">              ((SubQFilterBlock) child).setOpType(OPType.IN);</span></div><div class="token-line"><span class="token plain">              break;</span></div><div class="token-line"><span class="token plain">            case ISNULL:</span></div><div class="token-line"><span class="token plain">              ((SubQFilterBlock) child).setOpType(OPType.ISNOTNULL);</span></div><div class="token-line"><span class="token plain">              break;</span></div><div class="token-line"><span class="token plain">            case ISNOTNULL:</span></div><div class="token-line"><span class="token plain">              ((SubQFilterBlock) child).setOpType(OPType.ISNULL);</span></div><div class="token-line"><span class="token plain">              break;</span></div><div class="token-line"><span class="token plain">            default:</span></div><div class="token-line"><span class="token plain">              // should not come here</span></div><div class="token-line"><span class="token plain">              assert (false);</span></div><div class="token-line"><span class="token plain">            }</span></div><div class="token-line"><span class="token plain">            newOp = child;</span></div><div class="token-line"><span class="token plain">            break;</span></div><div class="token-line"><span class="token plain">          }</span></div><div class="token-line"><span class="token plain">          case NORMAL:</span></div><div class="token-line"><span class="token plain">            // we know all normal filters are either UnCorrelated or</span></div><div class="token-line"><span class="token plain">            // correlated, don&#x27;t have both case at present</span></div><div class="token-line"><span class="token plain">            NormalFilterBlock nf = (NormalFilterBlock) child;</span></div><div class="token-line"><span class="token plain">            assert (nf.getCorrelatedFilter() == null || nf.getUnCorrelatedFilter() == null);</span></div><div class="token-line"><span class="token plain">            CorrelatedFilter cf = nf.getCorrelatedFilter();</span></div><div class="token-line"><span class="token plain">            UnCorrelatedFilter ucf = nf.getUnCorrelatedFilter();</span></div><div class="token-line"><span class="token plain">            // It&#x27;s not likely to result in chaining SqlASTNode</span></div><div class="token-line"><span class="token plain">            // as any chaining NOT FB has been collapsed from top down</span></div><div class="token-line"><span class="token plain">            if (cf != null) {</span></div><div class="token-line"><span class="token plain">              cf.setRawFilterExpr(</span></div><div class="token-line"><span class="token plain">                  SqlXlateUtil.revertFilter(cf.getRawFilterExpr(), false));</span></div><div class="token-line"><span class="token plain">            }</span></div><div class="token-line"><span class="token plain">            if (ucf != null) {</span></div><div class="token-line"><span class="token plain">              ucf.setRawFilterExpr(</span></div><div class="token-line"><span class="token plain">                  SqlXlateUtil.revertFilter(ucf.getRawFilterExpr(), false));</span></div><div class="token-line"><span class="token plain">            }</span></div><div class="token-line"><span class="token plain">            newOp = child;</span></div><div class="token-line"><span class="token plain">            break;</span></div><div class="token-line"><span class="token plain">          default:</span></div><div class="token-line"><span class="token plain">          }</span></div><div class="token-line"><span class="token plain">          fb.getParent().replaceChildTree(fb, newOp);</span></div><div class="token-line"><span class="token plain">        }</span></div><div class="token-line"><span class="token plain">        if (fb.hasLeftChild()) {</span></div><div class="token-line"><span class="token plain">          digestNotOp(fb.getLeftChild(), ctx);</span></div><div class="token-line"><span class="token plain">        }</span></div><div class="token-line"><span class="token plain">        if (fb.hasRightChild()) {</span></div><div class="token-line"><span class="token plain">          digestNotOp(fb.getRightChild(), ctx);</span></div><div class="token-line"><span class="token plain">        }</span></div><div class="token-line"><span class="token plain">      }</span></div></pre></div><p>我当时就觉得，我太难了。</p><h2 id="单一职责原则"><a aria-hidden="true" tabindex="-1" href="/blog-backend/后端技术面试38讲/03.软件的设计原理/07#单一职责原则"><span class="icon icon-link"></span></a>单一职责原则</h2><p>软件设计有两个基本准则：低耦合和高内聚。我在前面讲到过的设计原则和后面将要讲的设计模式大多数都是关于如何进行低耦合设计的。而内聚性主要研究组成一个模块或者类的内部元素的功能相关性。</p><p>设计类的时候，我们应该把强相关的元素放在一个类里，而弱相关性的元素放在类的外边。保持类的高内聚性。具体设计时应该遵循这样一个设计原则：</p><p><strong>一个类，应该只有一个引起它变化的原因</strong>。</p><p>这就是软件设计的单一职责原则。如果一个类承担的职责太多，就等于把这些职责都耦合在一起。这种耦合会导致类很脆弱：当变化发生的时候，会引起类不必要的修改，进而导致bug出现。</p><p>职责太多，还会导致类的代码太多。一个类太大，它就很难保证满足开闭原则，如果不得不打开类文件进行修改，大堆大堆的代码呈现在屏幕上，一不小心就会引出不必要的错误。</p><p>所以关于编程有这样一个最佳实践：一个类文件打开后，最好不要超过屏幕的一屏。这样做的好处是，一方面代码少，职责单一，可以更容易地进行复用和扩展，更符合开闭原则。另一方面，阅读简单，维护方便。</p><h2 id="一个违反单一职责原则的例子"><a aria-hidden="true" tabindex="-1" href="/blog-backend/后端技术面试38讲/03.软件的设计原理/07#一个违反单一职责原则的例子"><span class="icon icon-link"></span></a>一个违反单一职责原则的例子</h2><p>如何判断一个类的职责是否单一，就是看这个类是否只有一个引起它变化的原因。</p><p>我们看这样一个设计：</p><p><img src="/blog-backend/static/httpsstatic001geekbangorgresourceimageefdaef2ff1193e0f61c6d8312489011247da.072eed23.png" alt=""/></p><p>正方形类Rectangle有两个方法，一个是绘图方法draw()，一个是计算面积方法area()。有两个应用需要依赖这个Rectangle类，一个是几何计算应用，一个是图形界面应用。</p><p>绘图的时候，程序需要计算面积，但是计算面积的时候呢，程序又不需要绘图。而在计算机屏幕上绘图又是一件非常麻烦的事情，所以需要依赖一个专门的GUI组件包。</p><p>这样就会出现一个尴尬的情形：当我需要开发一个几何计算应用程序的时候，我需要依赖Rectangle类，而Rectangle类又依赖了GUI包，一个GUI包可能有几十M甚至数百M。本来几何计算程序作为一个纯科学计算程序，主要是一些数学计算代码，现在程序打包完，却不得不把一个不相关的GUI包也打包进来。本来程序包可能只有几百K，现在变成了几百M。</p><p>Rectangle类的设计就违反了单一职责原则。Rectangle承担了两个职责，一个是几何形状的计算，一个是在屏幕上绘制图形。也就是说，Rectangle类有两个引起它变化的原因，这种不必要的耦合不仅会导致科学计算应用程序庞大，而且当图形界面应用程序不得不修改Rectangle类的时候，还得重新编译几何计算应用程序。</p><p>比较好的设计是将这两个职责分离开来，将Rectangle类拆分成两个类：</p><p><img src="/blog-backend/static/httpsstatic001geekbangorgresourceimagebf7cbf407bc21f9edfff9ae4e2b538d3797c.866d0ae9.png" alt=""/></p><p>将几何面积计算方法拆分到一个独立的类GeometricRectangle，这个类负责图形面积计算area()。Rectangle只保留单一绘图职责draw()，现在绘制长方形的时候可以使用计算面积的方法，而几何计算应用程序则不需要依赖一个不相关的绘图方法以及一大堆的GUI组件。</p><h2 id="从web应用架构演进看单一职责原则"><a aria-hidden="true" tabindex="-1" href="/blog-backend/后端技术面试38讲/03.软件的设计原理/07#从web应用架构演进看单一职责原则"><span class="icon icon-link"></span></a>从Web应用架构演进看单一职责原则</h2><p>事实上，Web应用技术的发展、演化过程，也是一个不断进行职责分离，实现单一职责原则的过程。在十几年前，互联网应用早期的时候，业务简单，技术落后，通常是一个类负责处理一个请求处理。</p><p>以Java为例，就是一个Servlet完成一个请求处理。</p><p><img src="data:image/png;base64,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" alt=""/></p><p>这种技术方案有一个比较大的问题是，请求处理以及响应的全部操作都在Servlet里，Servlet获取请求数据，进行逻辑处理，访问数据库，得到处理结果，根据处理结果构造返回的HTML。这些职责全部都在一个类里完成，特别是输出HTML，需要在Servlet中一行一行输出HTML字符串，类似这样：</p><div class="__dumi-default-code-block"><pre class="prism-code language-unknown"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token plain">response.getWriter().println(&quot;&lt;html&gt; &lt;head&gt; &lt;title&gt;servlet程序&lt;/title&gt; &lt;/head&gt;&quot;);</span></div></pre></div><p>这就比较痛苦了，一个HMTL文件可能会很大，在代码中一点一点拼字符串，编程困难、维护困难，总之就是各种困难。</p><p>于是后来就有了JSP，如果说Servlet是在程序中输出HTML，那么JSP就是在HTML调用程序。使用JSP开发Web程序大概是这样的：</p><p><img src="data:image/png;base64,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" alt=""/></p><p>用户请求提交给JSP，而JSP会依赖业务模型进行逻辑处理，并将模型的处理结果包装在HTML里面，构造成一个动态页面返回给用户。</p><p>使用JSP技术比Servlet更容易开发一点，至少不用再痛苦地进行HTML字符串拼接了，通常基于JSP开发的Web程序在职责上也会进行了一些最基本的分离：构造页面的JSP和处理逻辑的业务模型分离。但是这种分离藕断丝连，JSP中依然存在大量的业务逻辑代码，代码和HTML标签耦合在一起，职责分离得并不彻底。</p><p>真正将视图和模型分离的是后来出现的各种MVC框架，MVC框架通过控制器将视图与模型彻底分离。视图中只包含HTML标签和模板引擎的占位符，业务模型则专门负责进行业务处理。正是这种分离，使得前后端开发成为两个不同的工种，前端工程师只做视图模板开发，后端工程师只做业务开发，彼此之间没有直接的依赖和耦合，各自独立开发、维护自己的代码。</p><p><img src="/blog-backend/static/httpsstatic001geekbangorgresourceimagee375e3333324d165146ff1d338e1ec507a75.e20c64cf.png" alt=""/></p><p>有了MVC，就可以顺理成章地将复杂的业务模型进行分层了。通过分层方式，将业务模型分为业务层、服务层、数据持久层，使各层职责进一步分离，更符合单一职责原则。</p><p><img src="/blog-backend/static/httpsstatic001geekbangorgresourceimage1aed1a327f9b9c8a36365d90473bb34633ed.432bf511.png" alt=""/></p><h2 id="小结"><a aria-hidden="true" tabindex="-1" href="/blog-backend/后端技术面试38讲/03.软件的设计原理/07#小结"><span class="icon icon-link"></span></a>小结</h2><p>让我们回到文章的标题，类的职责应该是单一的，也就是引起类变化的原因应该只有一个，这样类的代码通常也是比较少的。在开发实践中，一个类文件在IDE打开，最好不要超过一屏。</p><p>文章开头那个大数据SQL引擎的例子中，SQL语法处理类的主要问题是，太多功能职责被放在一个类里了。我在研读了原型代码，并和开发原型的同事讨论后，把这个类的职责从两个维度进行切分。一个维度是处理过程，整个处理过程可以分为语法定义、语法变形和语法生成这三个环节，每个SQL语句都需要依赖这三个环节。此外，我在第一个模块的<a target="_blank" rel="noopener noreferrer" href="https://time.geekbang.org/column/article/172000">第6篇文章<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="__dumi-default-external-link-icon"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>中讲到，每个SQL语句在处理的时候都要生成一个SQL语法树，而树是由很多节点组成的。从这个角度讲，每个语法树节点都应该由一个单一职责的类处理。</p><p>我从这两个维度将原来有着近万行代码的类进行职责拆分，拆分出几百个类，每个类的职责都比较单一，只负责一个语法树节点的一个处理过程。很多小的类只有几行代码，打开后只占IDE中一小部分，在显示器上一目了然，阅读、维护都很轻松。类之间没有耦合，而是在运行期，根据SQL语法树将将这些代表语法节点的类构造成一颗树，然后用设计模式中的<strong>组合模式</strong>进行遍历即可。</p><p>后续参与进来开发的同事，只需要针对还不支持的SQL语法功能点，开发相对应的语法转换器Transformer和语法树生成器Generator就可以了，不需要对原来的类再进行修改，甚至不需要调用原来的类。程序运行期，在语法处理的时候遇到对应的语法节点，交给相关的类处理就好了。</p><p>重构后虽然类的数量扩展了几百倍，但是代码总行数却少了很多，这是重构后的部分代码截图：</p><p><img src="/blog-backend/static/httpsstatic001geekbangorgresourceimage5382530bacb39d2548271fa972c26544b082.5f9c395a.png" alt=""/></p><h2 id="思考题"><a aria-hidden="true" tabindex="-1" href="/blog-backend/后端技术面试38讲/03.软件的设计原理/07#思考题"><span class="icon icon-link"></span></a>思考题</h2><p>你在软件开发中有哪些可以用单一职责原则改进的设计呢？</p><p>欢迎你在评论区写下你的思考，也欢迎把这篇文章分享给你的朋友或者同事，一起交流一下。</p></div><div class="__dumi-default-layout-footer-meta"><a target="_blank" rel="noopener noreferrer" href="https://github.com/GGwujun/blog/edit/master/ssrc/后端技术面试38讲/03.软件的设计原理/07.md">在 GitHub 上编辑此页<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="__dumi-default-external-link-icon"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a><span data-updated-text="最后更新时间：">2023/9/27 11:15:40</span></div></div></div></div>
	<script>
  window.g_useSSR = true;
  window.g_initialProps = {};
	</script>

    <script>
      (function () {
        if (!location.port) {
          (function (i, s, o, g, r, a, m) {
            i["GoogleAnalyticsObject"] = r;
            (i[r] =
              i[r] ||
              function () {
                (i[r].q = i[r].q || []).push(arguments);
              }),
              (i[r].l = 1 * new Date());
            (a = s.createElement(o)), (m = s.getElementsByTagName(o)[0]);
            a.async = 1;
            a.src = g;
            m.parentNode.insertBefore(a, m);
          })(
            window,
            document,
            "script",
            "//www.google-analytics.com/analytics.js",
            "ga"
          );
          ga("create", "UA-149864185-1", "auto");
          ga("send", "pageview");
        }
      })();
    </script>
    <script src="/blog-backend/umi.e14e5a14.js"></script>
  </body>
</html>
